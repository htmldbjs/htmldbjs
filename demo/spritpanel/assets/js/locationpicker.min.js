!function(t){function e(t,e){var n=new google.maps.Map(t,e),o=new google.maps.Marker({position:new google.maps.LatLng(54.19335,-3.92695),map:n,title:"Drag Me",visible:e.markerVisible,draggable:e.markerDraggable,icon:void 0!==e.markerIcon?e.markerIcon:void 0});return{map:n,marker:o,circle:null,location:o.position,radius:e.radius,locationName:e.locationName,addressComponents:{formatted_address:null,addressLine1:null,addressLine2:null,streetName:null,streetNumber:null,city:null,district:null,state:null,stateOrProvince:null},settings:e.settings,domContainer:t,geodecoder:new google.maps.Geocoder}}function n(t){return void 0!=o(t)}function o(e){return t(e).data("locationpicker")}function a(t,e){if(t){var n=l.locationFromLatLng(e.marker.position);t.latitudeInput&&t.latitudeInput.val(n.latitude).change(),t.longitudeInput&&t.longitudeInput.val(n.longitude).change(),t.radiusInput&&t.radiusInput.val(e.radius).change(),t.locationNameInput&&t.locationNameInput.val(e.locationName).change()}}function i(e,n){if(e){if(e.radiusInput&&e.radiusInput.on("change",function(e){var o=t(this).val();e.originalEvent&&!isNaN(o)&&(n.radius=o,l.setPosition(n,n.location,function(t){t.settings.onchanged.apply(n.domContainer,[l.locationFromLatLng(t.location),t.radius,!1])}))}),e.locationNameInput&&n.settings.enableAutocomplete){var o=!1;n.autocomplete=new google.maps.places.Autocomplete(e.locationNameInput.get(0),n.settings.autocompleteOptions),google.maps.event.addListener(n.autocomplete,"place_changed",function(){o=!1;var t=n.autocomplete.getPlace();t.geometry?l.setPosition(n,t.geometry.location,function(t){a(e,t),t.settings.onchanged.apply(n.domContainer,[l.locationFromLatLng(t.location),t.radius,!1])}):n.settings.onlocationnotfound(t.name)}),n.settings.enableAutocompleteBlur&&(e.locationNameInput.on("change",function(t){t.originalEvent&&(o=!0)}),e.locationNameInput.on("blur",function(i){i.originalEvent&&setTimeout(function(){var i=t(e.locationNameInput).val();i.length>5&&o&&(o=!1,n.geodecoder.geocode({address:i},function(t,o){o==google.maps.GeocoderStatus.OK&&t&&t.length&&l.setPosition(n,t[0].geometry.location,function(t){a(e,t),t.settings.onchanged.apply(n.domContainer,[l.locationFromLatLng(t.location),t.radius,!1])})}))},1e3)}))}e.latitudeInput&&e.latitudeInput.on("change",function(e){var o=t(this).val();e.originalEvent&&!isNaN(o)&&l.setPosition(n,new google.maps.LatLng(o,n.location.lng()),function(t){t.settings.onchanged.apply(n.domContainer,[l.locationFromLatLng(t.location),t.radius,!1]),a(n.settings.inputBinding,n)})}),e.longitudeInput&&e.longitudeInput.on("change",function(e){var o=t(this).val();e.originalEvent&&!isNaN(o)&&l.setPosition(n,new google.maps.LatLng(n.location.lat(),o),function(t){t.settings.onchanged.apply(n.domContainer,[l.locationFromLatLng(t.location),t.radius,!1]),a(n.settings.inputBinding,n)})})}}function r(t){google.maps.event.trigger(t.map,"resize"),setTimeout(function(){t.map.setCenter(t.marker.position)},300)}function s(e,n,o){var a=t.extend({},t.fn.locationpicker.defaults,o),r=a.location.latitude,s=a.location.longitude,c=a.radius,u=e.settings.location.latitude,d=e.settings.location.longitude,g=e.settings.radius;r==u&&s==d&&c==g||(e.settings.location.latitude=r,e.settings.location.longitude=s,e.radius=c,l.setPosition(e,new google.maps.LatLng(e.settings.location.latitude,e.settings.location.longitude),function(t){i(e.settings.inputBinding,e),t.settings.oninitialized(n)}))}var l={drawCircle:function(e,n,o,a){return null!=e.circle&&e.circle.setMap(null),o>0?(o*=1,a=t.extend({strokeColor:"#0000FF",strokeOpacity:.35,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.2},a),a.map=e.map,a.radius=o,a.center=n,e.circle=new google.maps.Circle(a),e.circle):null},setPosition:function(t,e,n){t.location=e,t.marker.setPosition(e),t.map.panTo(e),this.drawCircle(t,e,t.radius,{}),t.settings.enableReverseGeocode?this.updateLocationName(t,n):n&&n.call(this,t)},locationFromLatLng:function(t){return{latitude:t.lat(),longitude:t.lng()}},addressByFormat:function(t,e){for(var n=null,o=t.length-1;o>=0;o--)t[o].types.indexOf(e)>=0&&(n=t[o]);return n||t[0]},updateLocationName:function(t,e){t.geodecoder.geocode({latLng:t.marker.position},function(n,o){if(o==google.maps.GeocoderStatus.OK&&n.length>0){var a=l.addressByFormat(n,t.settings.addressFormat);t.locationName=a.formatted_address,t.addressComponents=l.address_component_from_google_geocode(a.address_components)}else if(o==google.maps.GeocoderStatus.OVER_QUERY_LIMIT)return setTimeout(function(){l.updateLocationName(t,e)},1e3);e&&e.call(this,t)})},address_component_from_google_geocode:function(t){for(var e={},n=t.length-1;n>=0;n--){var o=t[n];o.types.indexOf("postal_code")>=0?e.postalCode=o.short_name:o.types.indexOf("street_number")>=0?e.streetNumber=o.short_name:o.types.indexOf("route")>=0?e.streetName=o.short_name:o.types.indexOf("locality")>=0?e.city=o.short_name:o.types.indexOf("sublocality")>=0?e.district=o.short_name:o.types.indexOf("administrative_area_level_1")>=0?e.stateOrProvince=o.short_name:o.types.indexOf("country")>=0&&(e.country=o.short_name)}return e.addressLine1=[e.streetNumber,e.streetName].join(" ").trim(),e.addressLine2="",e}};t.fn.locationpicker=function(c,u){if("string"==typeof c){var d=this.get(0);if(!n(d))return;var g=o(d);switch(c){case"location":if(void 0==u){var m=l.locationFromLatLng(g.location);return m.radius=g.radius,m.name=g.locationName,m}u.radius&&(g.radius=u.radius),l.setPosition(g,new google.maps.LatLng(u.latitude,u.longitude),function(t){a(t.settings.inputBinding,t)});break;case"subscribe":if(void 0==u)return null;var p=u.event,f=u.callback;if(!p||!f)return console.error('LocationPicker: Invalid arguments for method "subscribe"'),null;google.maps.event.addListener(g.map,p,f);break;case"map":if(void 0==u){var v=l.locationFromLatLng(g.location);return v.formattedAddress=g.locationName,v.addressComponents=g.addressComponents,{map:g.map,marker:g.marker,location:v}}return null;case"autosize":return r(g),this}return null}return this.each(function(){function r(){l.setPosition(g,g.marker.position,function(t){var e=l.locationFromLatLng(g.location);a(g.settings.inputBinding,g),t.settings.onchanged.apply(g.domContainer,[e,t.radius,!0])})}var u=t(this);if(n(this))s(o(this),t(this),c);else{var d=t.extend({},t.fn.locationpicker.defaults,c),g=new e(this,t.extend({},{zoom:d.zoom,center:new google.maps.LatLng(d.location.latitude,d.location.longitude),mapTypeId:d.mapTypeId,mapTypeControl:!1,styles:d.styles,disableDoubleClickZoom:!1,scrollwheel:d.scrollwheel,streetViewControl:!1,radius:d.radius,locationName:d.locationName,settings:d,autocompleteOptions:d.autocompleteOptions,addressFormat:d.addressFormat,draggable:d.draggable,markerIcon:d.markerIcon,markerDraggable:d.markerDraggable,markerVisible:d.markerVisible},d.mapOptions));u.data("locationpicker",g),d.markerInCenter&&(g.map.addListener("bounds_changed",function(){g.marker.dragging||(g.marker.setPosition(g.map.center),a(g.settings.inputBinding,g))}),g.map.addListener("idle",function(){g.marker.dragging||r()})),google.maps.event.addListener(g.marker,"drag",function(t){a(g.settings.inputBinding,g)}),google.maps.event.addListener(g.marker,"dragend",function(t){r()}),l.setPosition(g,new google.maps.LatLng(d.location.latitude,d.location.longitude),function(t){a(d.inputBinding,g),i(d.inputBinding,g),t.settings.oninitialized(u)})}})},t.fn.locationpicker.defaults={location:{latitude:40.7324319,longitude:-73.82480777777776},locationName:"",radius:500,zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:[],mapOptions:{},scrollwheel:!0,inputBinding:{latitudeInput:null,longitudeInput:null,radiusInput:null,locationNameInput:null},enableAutocomplete:!1,enableAutocompleteBlur:!1,autocompleteOptions:null,addressFormat:"postal_code",enableReverseGeocode:!0,draggable:!0,onchanged:function(t,e,n){},onlocationnotfound:function(t){},oninitialized:function(t){},markerIcon:void 0,markerDraggable:!0,markerVisible:!0}}(jQuery);