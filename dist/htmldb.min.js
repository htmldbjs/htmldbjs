/*! < ())) > HTMLDB.js - v1.0.0 | https://github.com/htmldbjs/htmldbjs/ | MIT license */
var HTMLDB={readQueue:[],readingQueue:[],readQueueCallbacks:[],activeFormFields:[],indexedDB:null,indexedDBConnection:null,indexedDBTables:[],initialize:function(){HTMLDB.initializeHTMLDBTables(),HTMLDB.initializeHTMLDBFormTables(),HTMLDB.initializeHTMLDBTemplates(),HTMLDB.initializeHTMLDBButtons(),HTMLDB.initializeHTMLDBInputs(),HTMLDB.initializeHTMLDBPaginations(),HTMLDB.initializeHTMLDBSections(),HTMLDB.initializeHTMLDBForms(),HTMLDB.initializeHTMLDBSelects(),HTMLDB.initializeHTMLDBToggles(),HTMLDB.initializeHTMLDBUpdaters(),HTMLDB.initializeReadQueue(),HTMLDB.resetWriterLoop()},stop:function(e){var t=document.getElementById(e);t&&(t.setAttribute("data-htmldb-loading",0),HTMLDB.hideLoaders())},read:function(t,r){var n=document.getElementById(t);if(!n)throw new Error("HTMLDB table "+t+" will be readed, but not found.");if(0<parseInt(n.getAttribute("data-htmldb-loading")))throw new Error("HTMLDB table "+t+" is loading right now.");if(""!=HTMLDB.getHTMLDBParameter(n,"table"))return HTMLDB.readChildTable(t,r);var e=HTMLDB.getHTMLDBParameter(n,"form"),a=HTMLDB.getHTMLDBParameter(n,"read-url");if(""==(a=HTMLDB.evaluateHTMLDBExpression(a,e)))throw new Error("HTMLDB table "+t+" read URL attribute is empty.");var i=document.getElementById(t+"_reader_tbody");HTMLDB.isHTMLDBParameter(n,"read-incremental")||(i.innerHTML="");var o=document.getElementById(t+"_iframe_container").children.length;HTMLDB.createNewIframeAndForm(t,o);var d=t+"_iframe_"+o;if(!document.getElementById(d))throw new Error("HTMLDB table "+t+" target iframe not found.");var l=document.getElementById(d),u=l.cloneNode(!0);l.parentNode.replaceChild(u,l),l=u,n.setAttribute("data-htmldb-loading",1),HTMLDB.showLoader(t,"read");var c=HTMLDB.doReaderIframeLoad;r&&(c=function(e){n.setAttribute("data-htmldb-loading",0),HTMLDB.hideLoader(t,"read"),HTMLDB.doReaderIframeDefaultLoad(e,!0),r(t)}),l.addEventListener?l.addEventListener("load",c,!0):l.attachEvent&&l.attachEvent("onload",c);try{var m=new Date;-1==a.indexOf("?")?a+="?nocache="+m.getTime():a+="&nocache="+m.getTime(),l.src=a}catch(e){throw new Error("An error occured while reading HTMLDB table "+t+".")}},validate:function(t,e,r){var n=document.getElementById(t);if(!n)throw new Error("HTMLDB table "+t+" will be readed, but not found.");if(0<parseInt(n.getAttribute("data-htmldb-loading")))throw new Error("HTMLDB table "+t+" is loading right now.");if(null==e.id)throw new Error("HTMLDB table "+t+" rows must have unique id field.");var a=HTMLDB.getHTMLDBParameter(n,"validate-url");if(""==(a=HTMLDB.evaluateHTMLDBExpression(a)))throw new Error("HTMLDB table "+t+" validate URL attribute is empty.");var i=document.getElementById(t+"_iframe_container").children.length;HTMLDB.createNewIframeAndForm(t,i);var o=t+"_iframe_"+i;if(!document.getElementById(o))return!1;var d=document.getElementById(t+"_form_"+i),l=document.getElementById(o),u=l.cloneNode(!0);l.parentNode.replaceChild(u,l),l=u,n.setAttribute("data-htmldb-loading",1),HTMLDB.showLoader(t,"validate");var c=HTMLDB.doValidatorIframeLoad;r&&(c=function(){n.setAttribute("data-htmldb-loading",0),HTMLDB.hideLoader(t,"validate"),iframeWindow=top.frames[t+"_iframe_"+i];var e="";iframeWindow.document&&(e=String(iframeWindow.document.body.innerHTML).trim()),HTMLDB.removeIframeAndForm(t,i),r(t,e)}),l.addEventListener?l.addEventListener("load",c,!0):l.attachEvent&&l.attachEvent("onload",c),d.innerHTML="";var m='<input class="htmldb_action" type="hidden" name="htmldb_action0" value="'+(0==e.id?"inserted":"updated")+'" />',s="";for(var s in e)e.hasOwnProperty(s)&&(m+='<input class="htmldb_row" type="hidden" name="htmldb_row0_'+s+'" value="'+e[s]+'" />');d.innerHTML=m,d.action=a;try{d.submit()}catch(e){}},write:function(r,e,n){var a=document.getElementById(r);if(!a)throw new Error("HTMLDB table "+r+" will be readed, but not found.");if(0<parseInt(a.getAttribute("data-htmldb-loading")))throw new Error("HTMLDB table "+r+" is loading right now.");if(!0===e)return clearTimeout(a.tmWriteTimer),lWriteDelay=parseInt(a.getAttribute("data-write-delay")),isNaN(lWriteDelay)&&(lWriteDelay=2e3),void(a.tmWriteTimer=setTimeout(function(){clearTimeout(a.tmWriteTimer),HTMLDB.write(r,!1,n)},lWriteDelay));var t=HTMLDB.getHTMLDBParameter(a,"write-url");if(""==(t=HTMLDB.evaluateHTMLDBExpression(t)))throw new Error("HTMLDB table "+r+" write URL attribute is empty.");var i=document.getElementById(r+"_iframe_container").children.length;HTMLDB.createNewIframeAndForm(r,i);var o=r+"_iframe_"+i;if(document.getElementById(o)){var d=document.getElementById(r+"_writer_tbody").children,l=null,u=d.length,c=document.getElementById(r+"_form_"+i),m=document.getElementById(o),s=m.cloneNode(!0);m.parentNode.replaceChild(s,m),m=s,a.setAttribute("data-htmldb-loading",1),HTMLDB.showLoader(r,"write");var T=HTMLDB.doWriterIframeLoad;n&&(T=function(){a.setAttribute("data-htmldb-loading",0),HTMLDB.hideLoader(r,"write"),iframeWindow=top.frames[r+"_iframe_"+i];var e="";iframeWindow.document&&(e=String(iframeWindow.document.body.innerHTML).trim()),HTMLDB.removeIframeAndForm(r,i),n(r,e);var t=HTMLDB.getHTMLDBParameter(a,"redirect");""!=t&&(window.location=t)}),m.addEventListener?m.addEventListener("load",T,!0):m.attachEvent&&m.attachEvent("onload",T),c.innerHTML="";for(var B=0;B<u;B++)(l=d[B])&&(-1==l.className.indexOf("updated")&&-1==l.className.indexOf("inserted")&&-1==l.className.indexOf("deleted")||(HTMLDB.generateFormHTML(a,i,l),n||(l.parentNode.removeChild(l),B--)));c.action=t;try{c.submit()}catch(e){}}},readLocal:function(t,r){var n=document.getElementById(t);if(!n)throw new Error("HTMLDB table "+t+" will be readed, but not found.");if(0<parseInt(n.getAttribute("data-htmldb-loading")))throw new Error("HTMLDB table "+t+" is loading right now.");if(n.setAttribute("data-htmldb-loading",1),HTMLDB.showLoader(t,"read"),null==HTMLDB.indexedDBConnection){HTMLDB.indexedDBConnection=indexedDB.open("htmldb",1),HTMLDB.indexedDBConnection.onupgradeneeded=HTMLDB.doIndexedDBUpgradeNeeded;var e=null;e=r?function(e){n.setAttribute("data-htmldb-loading",0),HTMLDB.hideLoader(t,"read"),HTMLDB.initializeLocalTable(n),r(t)}:function(e){n.setAttribute("data-htmldb-loading",0),HTMLDB.hideLoader(t,"read"),HTMLDB.initializeLocalTable(n)},HTMLDB.indexedDBConnection.onsuccess=e}else n.setAttribute("data-htmldb-loading",0),HTMLDB.hideLoader(t,"read"),HTMLDB.initializeLocalTable(n),r&&r(t)},get:function(e,t){var r=document.getElementById(e);if(r){for(var n=null,a=HTMLDB.getColumnNames(r.id),i=a.length,o="",d=0;d<i;d++)(n=document.getElementById(e+"_reader_td"+t+a[d]))&&(""!=o&&(o+=","),o+='"'+a[d]+'":"'+HTMLDB.ejs(n.innerHTML)+'"');return o="{"+o+"}",JSON.parse(o)}},insert:function(e,t,r){var n=document.getElementById(e);if(n){void 0===r&&(r="");var a=document.getElementById(e+"_writer_tbody"),i=a.children.length,o='<tr class="inserted'+(""!=r?" "+r:"")+'" data-row-id="n'+i+'" id="'+n.id+"_trn"+i+'">';o+=HTMLDB.generateTDHTML(n,"_writer",t,"n"+i),o+="</tr>",a.innerHTML+=o,HTMLDB.isHTMLDBParameter(n,"local")&&((a=document.getElementById(e+"_reader_tbody")).innerHTML+=o,HTMLDB.updateLocal(n,"n"+i,t),HTMLDB.render(n))}},update:function(e,t,r,n){var a=document.getElementById(e);if(a){if(void 0===n&&(n=""),0==t)return HTMLDB.insert(e,r,n);var i=document.getElementById(e+"_writer_tr"+t);if(i){document.getElementById(e+"_writer_tbody");if(strTRContent=HTMLDB.generateTDHTML(a,"_writer",r,t),i.innerHTML=strTRContent,-1==i.className.indexOf("inserted")&&(i.className="updated"+(""!=n?" "+n:"")),HTMLDB.isHTMLDBParameter(a,"local")){if(!(i=document.getElementById(e+"_reader_tr"+t)))return;document.getElementById(e+"_reader_tbody"),strTRContent=HTMLDB.generateTDHTML(a,"_reader",r,t),i.innerHTML=strTRContent,HTMLDB.updateLocal(a,t,r),HTMLDB.render(a)}}}},updateLocal:function(e,t,r){if(null==HTMLDB.indexedDBConnection)throw new Error("HTMLDB IndexedDB not initialized.");var n=HTMLDB.indexedDBConnection.result,a=n.transaction("htmldb_"+e.id+"_reader","readwrite"),i=n.transaction("htmldb_"+e.id+"_writer","readwrite"),o=a.objectStore("htmldb_"+e.id+"_reader"),d=i.objectStore("htmldb_"+e.id+"_writer");o.put(r),d.put(r)},delete:function(e,t,r){if(document.getElementById(e)){void 0===r&&(r="");var n=document.getElementById(e+"_writer_tr"+t);n&&(n.className="deleted"+(""!=r?" "+r:""))}},render:function(e,t){var r=parseInt(HTMLDB.getActiveId(e));HTMLDB.renderTemplates(e),0<r&&(HTMLDB.renderPaginations(e),HTMLDB.renderSections(e),HTMLDB.renderForms(e),HTMLDB.renderSelects(e)),t?t():e.doHTMLDBRender&&e.doHTMLDBRender(e)},isLoading:function(){for(var e=document.body.querySelectorAll(".htmldb-table"),t=e.length,r=null,n=0;n<t;n++)if(r=e[n],1==parseInt(HTMLDB.getHTMLDBParameter(r,"loading")))return!0;return!1},isIdle:function(){if(HTMLDB.isLoading())return!1;for(var e=document.body.querySelectorAll(".htmldb-table"),t=e.length,r=null,n=0;n<t;n++)if(r=e[n],0<document.getElementById(r.id+"_writer_tbody").children.length)return!1;return!0},getColumnNames:function(e,t){for(var r=document.getElementById(e+"_reader_thead").children[0].children,n=null,a=r.length,i=new Array,o=0;o<a;o++)n=r[o],i.push(n.innerHTML);return!0===t&&i.sort(),i},getTableFieldActiveValue:function(e,t){var r=document.getElementById(e);if(!r)throw new Error("HTMLDB table/form "+e+" is referenced, but not found.");if(-1!=r.className.indexOf("htmldb-form"))return HTMLDB.getFormFieldActiveValue(e,t);var n=parseInt(HTMLDB.getHTMLDBParameter(r,"active-id"));if(isNaN(n)||n<1)throw new Error("HTMLDB table "+e+" is not active, or has no records.");if(columnElementId=e+"_reader_td"+n+t,!document.getElementById(columnElementId))throw new Error("HTMLDB table "+e+" column "+t+" not found.");return document.getElementById(e+"_reader_td"+n+t).innerHTML},getFormFieldActiveValue:function(e,t){var r=document.getElementById(e),n=HTMLDB.convertFormToObject(r);if(void 0===n[t])throw new Error("HTMLDB form "+e+" field "+t+" not found.");return n[t]},setActiveId:function(e,t){e.setAttribute("data-htmldb-active-id",t),HTMLDB.render(e)},getActiveId:function(e){return e.getAttribute("data-htmldb-active-id")},resetWriterLoop:function(){var e=document.body.HTMLDBWriterTimer;clearTimeout(e),e=setTimeout(function(){HTMLDB.writeTables(),HTMLDB.resetWriterLoop()},2e3),document.body.HTMLDBWriterTimer=e},writeTables:function(){for(var e=document.body.querySelectorAll(".htmldb-table"),t=e.length,r=null,n=null,a=0;a<t;a++)r=e[a],HTMLDB.isHTMLDBParameter(r,"read-only")||document.getElementById(r.id+"_writer_tbody")&&(HTMLDB.isHTMLDBParameter(r,"local")||0<parseInt(HTMLDB.getHTMLDBParameter(r,"loading"))||0!=(n=document.getElementById(r.id+"_writer_tbody")).children.length&&(0<n.querySelectorAll("tr.updating").length||(HTMLDB.markRows(n,"updating"),HTMLDB.write(r.id,!1,function(e,t){var r=document.getElementById(e+"_writer_tbody");HTMLDB.deleteMarkedRows(r,"updating"),0==r.children.length?HTMLDB.doTableWrite(document.getElementById(e)):HTMLDB.writeTables()}))))},doTableWrite:function(e){if(HTMLDB.isHTMLDBParameter(e,"write-only"))return!0;var t=HTMLDB.getHTMLDBParameter(e,"redirect");""!=t&&(window.location.href=t),document.getElementById(e.id+"_reader_tbody").innerHTML="",HTMLDB.updateReadQueue(e)},updateReadQueue:function(e){if(!HTMLDB.isInReadQueue(e)){var t,r=[],n="",a=0;r.push(e.id);var i=HTMLDB.extractChildTables();void 0!==i[e.id]&&(r=r.concat(i[e.id])),t=r.length;for(var o=0;o<t;o++)n=r[o],a=parseInt(HTMLDB.getHTMLDBParameter(e,"priority")),void 0===HTMLDB.readQueue[a]&&(HTMLDB.readQueue[a]=[]),HTMLDB.readQueue[a][HTMLDB.readQueue[a].length]=n;HTMLDB.processReadQueue()}},updateReadQueueCallbacks:function(e,t){void 0===HTMLDB.readQueueCallbacks[e.id]&&(HTMLDB.readQueueCallbacks[e.id]=[]);var r=HTMLDB.readQueueCallbacks[e.id].length;HTMLDB.readQueueCallbacks[e.id][r]=t},isInReadQueue:function(e){for(var t in HTMLDB.readQueue)if(-1!=t.indexOf(e.id))return!0;return!1},markRows:function(e,t){for(var r=e.children,n=r.length,a=null,i=0;i<n;i++)-1==(a=r[i]).className.indexOf(t)&&(""!=a.className&&(a.className+=" "),a.className+=t)},deleteMarkedRows:function(e,t){for(var r=e.getElementsByClassName(t);0<r.length;)e.removeChild(r[0])},renderTemplates:function(e){for(var t=document.getElementById(e.id+"_reader_tbody").children,r=document.body.querySelectorAll(".htmldb-template"),n=r.length,a=null,i="",o=null,d=0;d<n;d++)if(a=r[d],e.id==HTMLDB.getHTMLDBParameter(a,"table")){if(o=null,""==(i=HTMLDB.getHTMLDBParameter(a,"template-target")))throw new Error("HTMLDB template (index: "+d+")  target element not specified.");if(""!=i&&(o=document.getElementById(i)),!o)throw new Error("HTMLDB template (index: "+d+")  target element "+i+" not found.");a.renderFunction&&(a.renderFunction(e,t),HTMLDB.initializeHTMLDBButtons(o),a.dispatchEvent(new CustomEvent("htmldbrender",{detail:{}})))}},renderSections:function(e){for(var t=document.body.querySelectorAll(".htmldb-section"),r=t.length,n=null,a=0;a<r;a++)n=t[a],HTMLDB.getHTMLDBParameter(n,"table")==e.id&&(HTMLDB.renderSectionElement(n),HTMLDB.doParentElementToggle(n))},renderForms:function(e){for(var t=document.body.querySelectorAll(".htmldb-form"),r=t.length,n=null,a=0;a<r;a++)n=t[a],HTMLDB.getHTMLDBParameter(n,"table")==e.id&&(HTMLDB.renderFormElement(n),HTMLDB.doParentElementToggle(n));HTMLDB.initializeHTMLDBEditButtons(null,e)},renderSelects:function(e){for(var t=document.body.querySelectorAll("select.htmldb-field"),r=t.length,n=null,a=0;a<r;a++)n=t[a],HTMLDB.getHTMLDBParameter(n,"option-table")==e.id&&HTMLDB.renderSelectElement(n)},renderPaginations:function(e){for(var t=document.body.querySelectorAll(".htmldb-pagination"),r=t.length,n=null,a=0;a<r;a++)n=t[a],HTMLDB.getHTMLDBParameter(n,"table")==e.id&&HTMLDB.renderPaginationElement(n)},initializeHTMLDBIndexedDB:function(){HTMLDB.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB},initializeHTMLDBTables:function(){var e=document.body.querySelectorAll(".htmldb-table"),t=e.length,r=null,n=0;HTMLDB.indexedDBTables=[];for(var a=0;a<t;a++)r=e[a],HTMLDB.validateHTMLDBTableDefinition(r);for(a=0;a<t;a++)r=e[a],HTMLDB.createHelperElements(r),r.style.display="none",r.setAttribute("data-htmldb-loading",0),n=parseInt(HTMLDB.getHTMLDBParameter(r,"priority")),isNaN(n)&&(n=0,r.setAttribute("data-htmldb-priority",n)),HTMLDB.isHTMLDBParameter(r,"local")&&HTMLDB.indexedDBTables.push(r.id);var i=HTMLDB.extractParentTables();for(a=0;a<t;a++)0!=i[(r=e[a]).id]&&(HTMLDB.getHTMLDBParameter(r,"priority")>HTMLDB.getMaxPriority(i[r.id])||(n=HTMLDB.getMaxPriority(i[r.id])+1,r.setAttribute("data-htmldb-priority",n)))},initializeHTMLDBFormTables:function(){var e=document.body.querySelectorAll(".htmldb-table"),t=e.length,r=null,n="",a=null,i="";HTMLDB.activeFormFields=[];for(var o=0;o<t;o++)if(r=e[o],""!=(n=HTMLDB.getHTMLDBParameter(r,"form"))){if(!(a=document.getElementById(n)))throw new Error("HTMLDB form "+n+" referenced by "+r.id+", but not found.");for(var d in void 0===HTMLDB.activeFormFields[n]&&(HTMLDB.activeFormFields[n]=[]),i=HTMLDB.getHTMLDBParameter(r,"read-url")+HTMLDB.getHTMLDBParameter(r,"filter"),HTMLDB.convertFormToObject(a))-1!=i.indexOf("{{"+d+"}}")&&(void 0===HTMLDB.activeFormFields[n][d]&&(HTMLDB.activeFormFields[n][d]=[]),HTMLDB.activeFormFields[n][d].push(r.id))}},initializeHTMLDBTemplates:function(){for(var e=document.body.querySelectorAll(".htmldb-template"),t=e.length,r=null,n="",a="",i="",o=0;o<t;o++){(r=e[o]).HTMLDBGUID=HTMLDB.generateGUID(),HTMLDB.validateHTMLDBTemplateDefinition(r),n=HTMLDB.getHTMLDBParameter(r,"table"),a=HTMLDB.getHTMLDBParameter(r,"template-target"),i=HTMLDB.generateTemplateRenderFunctionString(r,n,a);try{r.renderFunction=new Function("tableElement","rows",i)}catch(e){throw new Error("HTMLDB template (index:"+o+") render function could not be created.")}}},initializeHTMLDBButtons:function(e){HTMLDB.initializeHTMLDBRefreshButtons(e),HTMLDB.initializeHTMLDBAddButtons(e),HTMLDB.initializeHTMLDBEditButtons(e),HTMLDB.initializeHTMLDBSaveButtons(e),HTMLDB.initializeHTMLDBSortButtons(e)},initializeHTMLDBInputs:function(e){HTMLDB.initializeHTMLDBSaveInputs(e)},initializeHTMLDBPaginations:function(e){},initializeHTMLDBUpdaters:function(e){},initializeLocalTable:function(e){if(null==HTMLDB.indexedDBConnection)throw new Error("HTMLDB IndexedDB not initialized.");var t=HTMLDB.indexedDBConnection.result,r=t.transaction("htmldb_"+e.id+"_reader","readwrite"),n=t.transaction("htmldb_"+e.id+"_writer","readwrite"),a=r.objectStore("htmldb_"+e.id+"_reader"),i=n.objectStore("htmldb_"+e.id+"_writer"),o=a.getAll();o.onsuccess=function(){HTMLDB.initializeLocalTableRows(e,"reader",o.result),HTMLDB.render(e)};var d=i.getAll();d.onsuccess=function(){HTMLDB.initializeLocalTableRows(e,"writer",d.result)}},initializeLocalTableRows:function(e,t,r){for(var n=r.length,a=null,i=0,o="",d=0,l=0;l<n;l++)i=(a=r[l]).id,e.filterFunction&&!e.filterFunction(a)||(o+='<tr class="refreshed" data-row-id="'+i+'" id="'+e.id+"_"+t+"_tr"+i+'">',o+=HTMLDB.generateTDHTML(e,"_"+t,a,i),o+="</tr>",0==l&&(d=i));document.getElementById(tableElementId+"_"+t+"_tbody").innerHTML=o,e.setAttribute("data-htmldb-active-id",d)},resetForm:function(e){var t=e.elements,r=t.length;e.reset();for(var n=0;n<r;n++){switch(t[n].type.toLowerCase()){case"text":case"password":case"hidden":t[n].value="";break;case"textarea":t[n].innerHTML="";break;case"radio":case"checkbox":t[n].checked&&(t[n].checked=!1);break;case"select-one":case"select-multi":t[n].selectedIndex=-1,t[n].selectize&&t[n].selectize.clear(!0)}HTMLDB.hasHTMLDBParameter(t[n],"reset-value")&&HTMLDB.setInputValue(t[n],HTMLDB.evaluateHTMLDBExpression(HTMLDB.getHTMLDBParameter(t[n],"reset-value")))}e.dispatchEvent(new CustomEvent("htmldbreset",{detail:{}}))},initializeHTMLDBSections:function(){for(var e=document.body.querySelectorAll(".htmldb-section"),t=e.length,r=0;r<t;r++)HTMLDB.storeSectionElementTemplates(e[r])},storeSectionElementTemplates:function(e){if(!e)return!1;e.HTMLDBInitials={attributes:[],content:""};for(var t=e.attributes.length,r=null,n=0;n<t;n++)-1!=(r=e.attributes[n]).value.indexOf("{{")&&e.HTMLDBInitials.attributes.push({name:r.name,value:r.value});0==e.HTMLDBInitials.attributes.length&&(e.HTMLDBInitials.attributes=void 0);var a=e.children.length,i=null;for(n=0;n<a;n++)i=e.children[n],HTMLDB.storeSectionElementTemplates(i);0==a&&(-1!=e.innerHTML.indexOf("{{")?e.HTMLDBInitials.content=e.innerHTML:e.HTMLDBInitials.content=void 0),void 0===e.HTMLDBInitials.attributes&&void 0===e.HTMLDBInitials.content&&(e.HTMLDBInitials=void 0)},initializeHTMLDBForms:function(){for(var e=document.body.querySelectorAll(".htmldb-form"),t=e.length,r=null,n=0;n<t;n++)r=e[n],HTMLDB.initializeHTMLDBFormFields(r)},initializeHTMLDBFormFields:function(e){for(var t=e.querySelectorAll(".htmldb-field"),r=t.length,n=null,a="",i=0;i<r;i++)n=t[i],a=HTMLDB.getHTMLDBParameter(n,"field"),void 0!==HTMLDB.activeFormFields[e.id]&&void 0!==HTMLDB.activeFormFields[e.id][a]&&0<HTMLDB.activeFormFields[e.id][a].length&&HTMLDB.registerFormElementEvent(n,function(){HTMLDB.doActiveFormFieldUpdate(e.id,a)})},initializeHTMLDBSelects:function(){},initializeHTMLDBToggles:function(){var e,t=document.body.querySelectorAll(".htmldb-toggle"),r=t.length,n=null,a=null,i=[],o="",d=[],l="",u="",c="";for(var m=0;m<r;m++){if(n=t[m],-1!=(a=HTMLDB.extractToggleParentElement(n)).className.indexOf("htmldb-form"))u='var success=false;var object=HTMLDB.convertFormToObject(document.getElementById("'+a.id+'"));';else{if(l=HTMLDB.getHTMLDBParameter(a,"table"),!document.getElementById(l))throw new Error("HTMLDB section table "+l+" not found.");u='var success=false;var object=HTMLDB.get("'+l+'", HTMLDB.getActiveId(document.getElementById("'+l+'")));'}if(null==a)throw new Error("HTMLDB toggle (index: "+m+")  parent form/section  not found.");if(""!=(o=HTMLDB.getHTMLDBParameter(n,"filter"))){c=HTMLDB.generateFilterFunctionBlock(o,a),d=HTMLDB.extractFormToggleFields(o,a);try{n.toggleFunction=new Function(u+c+"return success;")}catch(e){throw new Error("HTMLDB toggle (index: "+m+")  toggle function could not be created.")}i.push(a),void 0===a.toggleFields&&(a.toggleFields=[]),a.toggleFields=a.toggleFields.concat(d)}}e=i.length;for(m=0;m<e;m++)-1!=(a=i[m]).className.indexOf("htmldb-form")&&HTMLDB.registerFormToggleEvents(a)},extractFormToggleFields:function(e,t){var r=String(e).split("/"),n=r.length,a=[];if(""==e)return[];for(var i=0;i<n;i+=3)property=HTMLDB.evaluateHTMLDBExpression(r[i]),""!=property&&a.push(property);return a},registerFormToggleEvents:function(e){var t=e.elements,r=t.length,n=null,a="";if(void 0!==e.toggleFields&&0!=e.toggleFields.length)for(var i=0;i<r;i++)n=t[i],""!=(a=HTMLDB.getHTMLDBParameter(n,"field"))&&-1!=e.toggleFields.indexOf(a)&&HTMLDB.registerFormElementEvent(n,function(){HTMLDB.doParentElementToggle(e)})},registerFormElementEvent:function(e,t){var r=e.tagName.toLowerCase(),n=e.type.toLowerCase();"input"==r?"checkbox"!=n&&"radio"!=n||(e.addEventListener?e.addEventListener("click",t,!0):e.attachEvent&&e.attachEvent("onclick",t)):"select"==r&&(e.addEventListener?e.addEventListener("change",t,!0):e.attachEvent&&e.attachEvent("onchange",t))},doParentElementToggle:function(e){for(var t=e.querySelectorAll(".htmldb-toggle"),r=t.length,n=null,a=0;a<r;a++)(n=t[a]).toggleFunction&&(n.toggleFunction()?n.style.display="block":n.style.display="none")},extractToggleParentElement:function(e){for(var t=!1,r=e.parentNode;!t&&"html"!=r.tagName.toLowerCase();)-1!=r.className.indexOf("htmldb-section")?t=!0:-1!=r.className.indexOf("htmldb-form")&&(t=!0),t||(r=r.parentNode);return t?r:null},renderSectionElement:function(e){if(!e)return!1;var t=HTMLDB.exploreHTMLDBTable(e);if(void 0!==e.HTMLDBInitials&&void 0!==e.HTMLDBInitials.attributes)for(var r=e.HTMLDBInitials.attributes.length,n="",a="",i="",o=0;o<r;o++)n=e.HTMLDBInitials.attributes[o].name,a=e.HTMLDBInitials.attributes[o].value,i=HTMLDB.evaluateHTMLDBExpression(a,t.id),e.setAttribute(n,i);var d=e.children.length,l=null;for(o=0;o<d;o++)l=e.children[o],HTMLDB.renderSectionElement(l);0==d&&(void 0!==e.HTMLDBInitials&&void 0!==e.HTMLDBInitials.content?(i=HTMLDB.evaluateHTMLDBExpression(e.HTMLDBInitials.content,t.id),e.innerHTML=i):HTMLDB.hasHTMLDBParameter(e,"content")&&(e.innerHTML=HTMLDB.getHTMLDBParameter(e,"content")))},renderFormElement:function(e){for(var t=e.querySelectorAll(".htmldb-field"),r=t.length,n=null,a="",i=HTMLDB.exploreHTMLDBTable(e),o="",d=0;d<r;d++)n=t[d],HTMLDB.getHTMLDBParameter(n,"field"),a=HTMLDB.getHTMLDBParameter(n,"value"),o=HTMLDB.evaluateHTMLDBExpression(a,i.id),HTMLDB.setInputValue(n,o),n.dispatchEvent(new CustomEvent("htmldbsetvalue",{detail:{value:o}}))},renderFormElementWithObject:function(e,t){for(var r=e.querySelectorAll(".htmldb-field"),n=r.length,a=null,i="",o="",d=0;d<n;d++)a=r[d],HTMLDB.getHTMLDBParameter(a,"field"),i=HTMLDB.getHTMLDBParameter(a,"value"),o=HTMLDB.evaluateHTMLDBExpressionWithObject(i,t),HTMLDB.setInputValue(a,o),a.dispatchEvent(new CustomEvent("htmldbsetvalue",{detail:{value:o}}))},renderPaginationElement:function(e){var t,r,n,a,i,o,d,l=HTMLDB.getHTMLDBParameter(e,"table"),u=document.getElementById(l),c=parseInt(HTMLDB.getActiveId(u)),m="";if(""==l)throw new Error("HTMLDB pagination table not specified.");if(!document.getElementById(l))throw new Error("HTMLDB pagination table "+l+" not found.");if(r=t=(m=HTMLDB.getHTMLDBParameter(e,"refresh-table")).split(","),refreshTable=null,""==m)throw new Error("HTMLDB pagination refresh table not specified.");for(var s=0;s<r;s++)if(refreshTable=document.getElementById(t[s]),!refreshTable)throw new Error("HTMLDB table "+t[s]+" referenced as pagination refresh table, but not found.");if(""==(n=HTMLDB.getHTMLDBParameter(e,"page-field")))throw new Error("HTMLDB pagination data-htmldb-page-field attribute not specified.");if(""==(a=HTMLDB.getHTMLDBParameter(e,"page-count-field")))throw new Error("HTMLDB pagination data-htmldb-page-count-field attribute not specified.");if(c<=0)throw new Error("HTMLDB pagination table "+l+" is not active, or has no records.");var T=l+"_reader_td"+c+n;if(!document.getElementById(T))throw new Error("HTMLDB pagination page field "+l+"."+n+" not found.");if(i=l+"_reader_td"+c+a,!document.getElementById(i))throw new Error("HTMLDB pagination page count field "+l+"."+a+" not found.");if(o=parseInt(document.getElementById(T).innerHTML),isNaN(o))throw new Error("HTMLDB pagination page value "+l+"."+a+" is not valid.");if(d=parseInt(document.getElementById(i).innerHTML),isNaN(d))throw new Error("HTMLDB pagination page count value "+l+"."+a+" is not valid.");e.setAttribute("data-htmldb-page",o),e.setAttribute("data-htmldb-page-count",d),e.classList.remove("htmldb-loading"),HTMLDB.removePaginationElements(e),HTMLDB.createPaginationElements(e),e.dispatchEvent(new CustomEvent("htmldbrender",{detail:{}}))},removePaginationElements:function(e){for(var t=e.getElementsByClassName("htmldb-pagination-element");0<t.length;)e.removeChild(t[0])},createPaginationElements:function(e){for(var t=HTMLDB.getHTMLDBParameter(e,"page"),r=HTMLDB.getHTMLDBParameter(e,"page-count"),n=null,a=null,i=null,o=null,d=null,l=e.children,u=l.length,c=null,m=0;m<u;m++)if(-1!=(c=l[m]).className.indexOf("htmldb-pagination-template")&&(-1!=c.className.indexOf("htmldb-pagination-previous")&&(n=c),-1!=c.className.indexOf("htmldb-pagination-next")&&(a=c),-1!=c.className.indexOf("htmldb-pagination-default")&&(i=c),-1!=c.className.indexOf("htmldb-pagination-active")&&(o=c),-1!=c.className.indexOf("htmldb-pagination-hidden")&&(d=c),0==c.querySelectorAll(".htmldb-button-page").length))throw new Error("HTMLDB pagination templates must have page buttons specified with htmldb-button-page class.");if(null==n&&null==a&&null==i)throw new Error("HTMLDB pagination previous-next or default page template(s) not specified.");if(null!=n&&null==a&&null==i)throw new Error("HTMLDB pagination previous page template defined but next or default page template not specified.");if(null!=a&&null==n&&null==i)throw new Error("HTMLDB pagination next page template defined but previous or default page template not specified.");if(null==o)throw new Error("HTMLDB pagination active template not specified.");if(t=parseInt(t),r=parseInt(r),previousPage=t-1,previousPage<0&&(previousPage=0),nextPage=t+1,nextPage>=r&&(nextPage=r-1),null!=n&&HTMLDB.clonePaginationElement(n,previousPage+1),r<7)for(m=0;m<r;m++)m==t?HTMLDB.clonePaginationElement(o,m+1):HTMLDB.clonePaginationElement(i,m+1);else{var s=0,T=r-1,B=!0,L=!0;t<4?(B=!1,s=0,T=4):r-5<t?(L=!1,s=r-5,T=r-1):(s=t-1,T=t+1),B&&(HTMLDB.clonePaginationElement(i,1),null!=d&&HTMLDB.clonePaginationElement(d,0));for(m=s;m<=T;m++)m==t?HTMLDB.clonePaginationElement(o,m+1):HTMLDB.clonePaginationElement(i,m+1);L&&(null!=d&&HTMLDB.clonePaginationElement(d,0),HTMLDB.clonePaginationElement(i,r))}null!=a&&HTMLDB.clonePaginationElement(a,nextPage+1)},clonePaginationElement:function(e,t){var r=e.cloneNode(!0);r.classList.remove("htmldb-pagination-template"),r.classList.add("htmldb-pagination-element"),e.parentNode.appendChild(r),HTMLDB.storeSectionElementTemplates(r),HTMLDB.renderElementWithObject(r,{page:t});for(var n=r.querySelectorAll(".htmldb-button-page"),a=n.length,i=null,o=0;o<a;o++)(i=n[o]).setAttribute("data-htmldb-page",t),i.addEventListener?i.addEventListener("click",HTMLDB.doPaginationButtonClick,!0):i.attachEvent&&i.attachEvent("onclick",HTMLDB.doPaginationButtonClick)},doPaginationButtonClick:function(e){var t=parseInt(e.currentTarget.getAttribute("data-htmldb-page"))-1;if(isNaN(t))throw new Error("HTMLDB pagination button has no valid data-htmldb-page attribute.");var r=HTMLDB.exploreHTMLDBPagination(e.currentTarget),n=HTMLDB.exploreHTMLDBTable(e.currentTarget);if(!n)throw new Error("HTMLDB pagination table not found.");if(-1!=(" "+r.className+" ").indexOf(" htmldb-loading "))return!1;r.classList.add("htmldb-loading");var a=parseInt(HTMLDB.getActiveId(n)),i=HTMLDB.get(n.id,a);if(void 0===i.page)throw new Error("HTMLDB pagination table "+n.id+" has no page column.");var o=HTMLDB.getHTMLDBParameter(r,"table-defaults");(i=HTMLDB.parseObjectDefaults(i,o)).page=t,document.getElementById(n.id+"_reader_td"+a+"page").innerHTML=t,HTMLDB.insert(n.id,i),HTMLDB.updateReadQueueWithParameter(r,"refresh-table"),r.dispatchEvent(new CustomEvent("htmldbpageclick",{detail:{page:t}}))},parseObjectDefaults:function(e,t){if(""==t)return e;try{defaultsObject=JSON.parse(t)}catch(e){throw new Error("HTMLDB defaults attribute value has no valid JSON format")}for(var r in defaultsObject)e[r]=defaultsObject[r];return e},renderElementWithObject:function(e,t){if(!e)return!1;if(!t)return!1;if(void 0!==e.HTMLDBInitials&&void 0!==e.HTMLDBInitials.attributes)for(var r=e.HTMLDBInitials.attributes.length,n="",a="",i="",o=0;o<r;o++)n=e.HTMLDBInitials.attributes[o].name,a=e.HTMLDBInitials.attributes[o].value,i=HTMLDB.evaluateHTMLDBExpressionWithObject(a,t),e.setAttribute(n,i);var d=e.children.length,l=null;for(o=0;o<d;o++)l=e.children[o],HTMLDB.renderElementWithObject(l,t);0==d&&(void 0!==e.HTMLDBInitials&&void 0!==e.HTMLDBInitials.content?(i=HTMLDB.evaluateHTMLDBExpressionWithObject(e.HTMLDBInitials.content,t),e.innerHTML=i):HTMLDB.hasHTMLDBParameter(e,"content")&&(e.innerHTML=HTMLDB.getHTMLDBParameter(e,"content")))},doActiveFormFieldUpdate:function(e,t){var r,n;if(void 0!==HTMLDB.activeFormFields[e]&&void 0!==HTMLDB.activeFormFields[e][t]&&0!=(r=HTMLDB.activeFormFields[e][t]).length){n=r.length;for(var a=0;a<n;a++)HTMLDB.read(r[a])}},renderSelectElement:function(e){var t=HTMLDB.getHTMLDBParameter(e,"option-table");if(""!=t){if(!document.getElementById(t))throw new Error("HTMLDB table "+t+" not found. Referenced by data-htmldb-option-table attribute of select element "+e.id);var r=document.getElementById(t),n=r.getAttribute("data-htmldb-active-id"),a=document.getElementById(t+"_reader_tbody").children,i=a.length,o=null,d=0,l="",u="";e.innerHTML="";for(var c=0;c<i;c++)o=a[c],d=HTMLDB.getHTMLDBParameter(o,"data-row-id"),HTMLDB.convertRowToObject(t,o),r.setAttribute("data-htmldb-active-id",d),l=HTMLDB.evaluateHTMLDBExpression(HTMLDB.getHTMLDBParameter(e,"option-title"),t),u=HTMLDB.evaluateHTMLDBExpression(HTMLDB.getHTMLDBParameter(e,"option-value"),t),e.options[e.options.length]=new Option(l,u);e.HTMLDBInitials={content:e.innerHTML},r.setAttribute("data-htmldb-active-id",n),e.dispatchEvent(new CustomEvent("htmldbsetoptions",{detail:{}}))}},initializeHTMLDBRefreshButtons:function(e){null==e&&(e=document.body);for(var t=e.querySelectorAll(".htmldb-button-refresh"),r=t.length,n=null,a=0;a<r;a++)(n=t[a]).addEventListener?n.addEventListener("click",HTMLDB.doRefreshButtonClick,!0):n.attachEvent&&n.attachEvent("onclick",HTMLDB.doRefreshButtonClick)},initializeHTMLDBAddButtons:function(e){null==e&&(e=document.body);for(var t=e.querySelectorAll(".htmldb-button-add"),r=t.length,n=null,a=0;a<r;a++)(n=t[a]).addEventListener?n.addEventListener("click",HTMLDB.doAddButtonClick,!0):n.attachEvent&&n.attachEvent("onclick",HTMLDB.doAddButtonClick)},initializeHTMLDBSaveButtons:function(e){null==e&&(e=document.body);for(var t=e.querySelectorAll(".htmldb-button-save"),r=t.length,n=null,a=0;a<r;a++)(n=t[a]).addEventListener?n.addEventListener("click",HTMLDB.doSaveButtonClick,!0):n.attachEvent&&n.attachEvent("onclick",HTMLDB.doSaveButtonClick)},initializeHTMLDBSortButtons:function(e){null==e&&(e=document.body);for(var t=e.querySelectorAll(".htmldb-button-sort"),r=t.length,n=null,a=0;a<r;a++)(n=t[a]).addEventListener?n.addEventListener("click",HTMLDB.doSortButtonClick,!0):n.attachEvent&&n.attachEvent("onclick",HTMLDB.doSortButtonClick)},initializeHTMLDBEditButtons:function(e,t){null==e&&(e=document.body);for(var r=e.querySelectorAll(".htmldb-button-edit"),n=r.length,a=null,i=0;i<n;i++)a=r[i],t&&HTMLDB.getHTMLDBParameter(a,"table")!=t.id||(a.addEventListener?a.addEventListener("click",HTMLDB.doEditButtonClick,!0):a.attachEvent&&a.attachEvent("onclick",HTMLDB.doEditButtonClick))},initializeHTMLDBSaveInputs:function(e){null==e&&(e=document.body);for(var t=e.querySelectorAll(".htmldb-input-save"),r=t.length,n=null,a="",i="",o=0;o<r;o++)switch(n=t[o],a=String(n.tagName).toLowerCase(),i=String(n.getAttribute("type")).toLowerCase(),a){case"input":"checkbox"==i||"radio"==i?n.addEventListener?n.addEventListener("click",HTMLDB.doSaveInputEvent,!0):n.attachEvent&&n.attachEvent("onclick",HTMLDB.doSaveInputEvent):n.addEventListener?(n.addEventListener("input",HTMLDB.doSaveInputEvent,!0),n.addEventListener("keyup",HTMLDB.doSaveInputKeyUp,!0)):n.attachEvent&&(n.attachEvent("oninput",HTMLDB.doSaveInputEvent),n.attachEvent("onkeyup",HTMLDB.doSaveInputKeyUp));break;case"textarea":n.addEventListener?n.addEventListener("input",HTMLDB.doSaveInputEvent,!0):n.attachEvent&&n.attachEvent("oninput",HTMLDB.doSaveInputEvent);break;case"select":n.addEventListener?n.addEventListener("change",HTMLDB.doSaveInputEvent,!0):n.attachEvent&&n.attachEvent("onchange",HTMLDB.doSaveInputEvent);break;case"button":n.addEventListener?n.addEventListener("click",HTMLDB.doSaveInputEvent,!0):n.attachEvent&&n.attachEvent("onclick",HTMLDB.doSaveInputEvent)}},doSaveInputEvent:function(e){var t=e.currentTarget,r=parseInt(HTMLDB.getHTMLDBParameter(t,"save-delay"));isNaN(r)&&(r=500),0<r?(clearTimeout(t.tmSaveDelay),t.tmSaveDelay=setTimeout(function(){clearTimeout(t.tmSaveDelay),HTMLDB.doSaveInputEventNow(e)},r)):HTMLDB.doSaveInputEventNow(e)},doSaveInputKeyUp:function(e){e.currentTarget;13==e.keyCode&&HTMLDB.doSaveInputEventNow(e)},doSaveInputEventNow:function(e){var t=e.currentTarget;clearTimeout(t.tmSaveDelay);var r=getInputValue(e.currentTarget),n=HTMLDB.getHTMLDBParameter(t,"table"),a=document.getElementById(n),i=HTMLDB.getHTMLDBParameter(t,"input-field");if(!a)throw new Error("HTMLDB input table "+n+" not found.");if(-1!=(" "+t.className+" ").indexOf(" htmldb-loading "))return!1;t.classList.add("htmldb-loading");var o=parseInt(HTMLDB.getActiveId(a)),d=HTMLDB.get(a.id,o);if(void 0===d[i])throw new Error("HTMLDB input table "+a.id+" has no "+i+" column.");var l=HTMLDB.getHTMLDBParameter(t,"table-defaults");(d=HTMLDB.parseObjectDefaults(d,l))[i]=r,document.getElementById(a.id+"_reader_td"+o+i).innerHTML=r,HTMLDB.updateReadQueueCallbacks(a,function(){t.classList.remove("htmldb-loading")}),HTMLDB.insert(a.id,d),HTMLDB.updateReadQueueWithParameter(t,"refresh-table"),t.dispatchEvent(new CustomEvent("htmldbsave",{detail:{}}))},doSortButtonClick:function(e){var t=e.currentTarget,r=HTMLDB.getHTMLDBParameter(t,"table"),n=document.getElementById(r),a=HTMLDB.getHTMLDBParameter(t,"sort-field"),i=HTMLDB.getHTMLDBParameter(t,"sort-value"),o=HTMLDB.getHTMLDBParameter(t,"direction-field"),d=!1;if(!n)throw new Error("HTMLDB button table "+r+" not found.");var l=" "+t.className+" ";if(-1!=l.indexOf(" htmldb-loading "))return!1;d=-1!=l.indexOf(" htmldb-sorting-asc ");var u=parseInt(HTMLDB.getActiveId(n)),c=HTMLDB.get(n.id,u);if(void 0===c[a])throw new Error("HTMLDB button table "+n.id+" has no "+a+" column.");if(void 0===c[o])throw new Error("HTMLDB button table "+n.id+" has no "+o+" column.");t.classList.add("htmldb-loading"),d?(t.classList.remove("htmldb-sorting-asc"),t.classList.add("htmldb-sorting-desc"),t.setAttribute("data-htmldb-sorting-asc",0)):(t.classList.add("htmldb-sorting-asc"),t.classList.remove("htmldb-sorting-desc"),t.setAttribute("data-htmldb-sorting-asc",1));var m=HTMLDB.getHTMLDBParameter(t,"table-defaults");(c=HTMLDB.parseObjectDefaults(c,m))[a]=i,c[o]=d?2:1,document.getElementById(n.id+"_reader_td"+u+a).innerHTML=i,document.getElementById(n.id+"_reader_td"+u+o).innerHTML=c[o],HTMLDB.updateReadQueueCallbacks(n,function(){t.classList.remove("htmldb-loading")}),console.log(c),HTMLDB.insert(n.id,c),HTMLDB.updateReadQueueWithParameter(t,"refresh-table"),t.dispatchEvent(new CustomEvent("htmldbsort",{detail:{}}))},updateReadQueueWithParameter:function(e,t){for(var r=HTMLDB.getHTMLDBParameter(e,t).split(","),n=r.length,a="",i=null,o=0;o<n;o++){if(a=r[o],!(i=document.getElementById(a)))throw new Error("HTMLDB table "+a+" referenced in "+t+"attribute but not found.");HTMLDB.updateReadQueue(i)}},initializeReadQueue:function(){var e=document.body.querySelectorAll(".htmldb-table"),t=e.length,r=null,n=[],a=[],i=0,o=0;HTMLDB.readQueue=null;for(var d=0;d<t;d++)r=e[d],o=parseInt(HTMLDB.getHTMLDBParameter(r,"priority")),-1==n.indexOf(o)&&n.push(o);n.sort();for(d=0;d<t;d++)r=e[d],""==HTMLDB.getHTMLDBParameter(r,"form")&&(o=parseInt(HTMLDB.getHTMLDBParameter(r,"priority")),void 0===a[i=n.indexOf(o)]&&(a[i]=[]),a[i].push(r.id));HTMLDB.readQueue=a,HTMLDB.processReadQueue()},readChildTable:function(t,e){var r,n=document.getElementById(t);if(!n)throw new Error("HTMLDB table "+t+" will be readed, but not found.");if(0<parseInt(n.getAttribute("data-htmldb-loading")))throw new Error("HTMLDB table "+t+" is loading right now.");var a=HTMLDB.getHTMLDBParameter(n,"table");if(""==a)throw new Error("HTMLDB child table "+t+" has no table attribute.");if(!document.getElementById(a))throw new Error("HTMLDB table "+a+" is referenced by "+t+", but not found.");document.getElementById(t+"_reader_thead").innerHTML=document.getElementById(a+"_reader_thead").innerHTML,document.getElementById(t+"_writer_thead").innerHTML=document.getElementById(a+"_reader_thead").innerHTML,r=HTMLDB.generateChildTableFilterFunctionString(n);try{n.filterFunction=new Function("object",r)}catch(e){throw new Error("HTMLDB child table "+t+" filter function could not be created.")}for(var i=document.getElementById(a+"_reader_tbody").children,o=i.length,d=null,l=null,u=0,c="",m=0,s=0;s<o;s++)d=i[s],u=HTMLDB.getHTMLDBParameter(d,"data-row-id"),l=HTMLDB.convertRowToObject(a,d),n.filterFunction(l)&&(c+='<tr class="refreshed" data-row-id="'+u+'" id="'+t+"_reader_tr"+u+'">',c+=HTMLDB.generateTDHTML(n,"_reader",l,u),c+="</tr>",0==m&&(m=u));document.getElementById(t+"_reader_tbody").innerHTML=c,n.setAttribute("data-htmldb-active-id",m),HTMLDB.render(n)},convertRowToObject:function(e,t){for(var r={},n=t.children,a=n.length,i=null,o=t.getAttribute("data-row-id"),d=0;d<a;d++)r[(i=n[d]).id.replace(e+"_reader_td"+o,"")]=i.innerHTML;return r},getMaxPriority:function(e){for(var t=e.length,r=null,n=0,a=0,i=0;i<t;i++){if(!document.getElementById(e[i]))throw new Error("HTMLDB table "+e[i]+" is referenced, but not found.");r=document.getElementById(e[i]),n<(a=parseInt(HTMLDB.getHTMLDBParameter(r,"priority")))&&(n=a)}return n},processReadQueue:function(){if(void 0!==HTMLDB.readQueue&&0!=HTMLDB.readQueue.length&&HTMLDB.isIdle()){for(HTMLDB.readingQueue=void 0;void 0===HTMLDB.readingQueue&&0<HTMLDB.readQueue.length;)HTMLDB.readingQueue=HTMLDB.readQueue.shift();readingQueueCount=0,HTMLDB.readingQueue&&(readingQueueCount=HTMLDB.readingQueue.length),tableElementId="",tableElement=null;for(var e=0;e<readingQueueCount;e++)tableElementId=HTMLDB.readingQueue[e],tableElement=document.getElementById(tableElementId),HTMLDB.isHTMLDBParameter(tableElement,"local")?HTMLDB.readLocal(tableElementId):HTMLDB.read(tableElementId)}},removeFromReadingQueue:function(e){var t=HTMLDB.readingQueue.indexOf(e);-1<t&&HTMLDB.readingQueue.splice(t,1)},extractParentTables:function(){for(var e=document.body.querySelectorAll(".htmldb-table"),t=e.length,r=null,n=[],a="",i="",o=0;o<t;o++)n[(r=e[o]).id]=[],(a=HTMLDB.getHTMLDBParameter(r,"table"))&&(n[r.id]=n[r.id].concat(Array(a))),0<(i=HTMLDB.extractHTMLDBExpressionTables(HTMLDB.getHTMLDBParameter(r,"read-url"))).length&&(n[r.id]=n[r.id].concat(i)),0<(i=HTMLDB.extractHTMLDBExpressionTables(HTMLDB.getHTMLDBParameter(r,"write-url"))).length&&(n[r.id]=n[r.id].concat(i)),0<(i=HTMLDB.extractHTMLDBExpressionTables(HTMLDB.getHTMLDBParameter(r,"validate-url"))).length&&(n[r.id]=n[r.id].concat(i));return n},extractChildTables:function(){var e=HTMLDB.extractParentTables(),t=[],r=0,n=0,a="";for(a in e)for(r=e[a].length,n=0;n<r;n++)void 0===t[e[a][n]]&&(t[e[a][n]]=[]),t[e[a][n]].push(a);return t},extractHTMLDBExpressionTables:function(e){var t,r=String(e).split("{{"),n=null,a="",i="",o=0;if(r.length<=1)return[];t=r.length,tables=[];for(var d=1;d<t;d++){for(a=r[d],o=1;"}"!=a[o-1]&&"}"!=a[o];)o++;"$"!=(i=1<(n=String(a).substr(0,o).split(".")).length?n[0]:"")[0]&&(""!=i&&tables.push(i))}return tables},getHTMLDBParameter:function(e,t){return e.getAttribute("data-htmldb-"+t)?e.getAttribute("data-htmldb-"+t):e.getAttribute("htmldb-"+t)?e.getAttribute("htmldb-"+t):e.getAttribute(t)?e.getAttribute(t):""},isHTMLDBParameter:function(e,t){var r=HTMLDB.getHTMLDBParameter(e,t);return"true"==r||"1"==r},hasHTMLDBParameter:function(e,t){return!!e.getAttribute("data-htmldb-"+t)||(!!e.getAttribute("htmldb-"+t)||!!e.getAttribute(t))},getURLParameter:function(e){if(isNaN(e))return"";var t=window.location.href,r=(t=t.replace(window.location.origin,"")).split("/");return e<0&&(e=r.length+e),void 0!==r[e]?r[e]:""},validateHTMLDBTableDefinition:function(e){var t=["_reader_table","_writer_table","_reader_thead","_writer_thead","_reader_tbody","_writer_tbody","_iframe_container","_form_container"],r=t.length;if(""==e.id)throw new Error("All HTMLDB table element must have a unique id attribute.");for(var n=0;n<r;n++)if(document.getElementById(e.id+t[n]))throw new Error(e.id+t[n]+" has been used.");var a=HTMLDB.getHTMLDBParameter(e,"form");if(""!=a&&!document.getElementById(a))throw new Error("HTMLDB table "+e.id+" referencing unknown form "+a)},validateHTMLDBTemplateDefinition:function(e){var t=HTMLDB.getHTMLDBParameter(e,"table"),r=HTMLDB.getHTMLDBParameter(e,"template-target");if(""==t||!document.getElementById(t))throw new Error(t+" HTMLDB table not found.");if(""==r||!document.getElementById(r))throw new Error("Template target element "+r+" not found.")},validateHTMLDBPaginationDefinition:function(e){},createHelperElements:function(e){var t,r,n="";n='<table id="'+e.id+'_reader_table"><thead id="'+e.id+'_reader_thead"></thead><tbody id="'+e.id+'_reader_tbody"></tbody></table>',n+='<table id="'+e.id+'_writer_table"><thead id="'+e.id+'_writer_thead"></thead><tbody id="'+e.id+'_writer_tbody"></tbody></table>',t='<div id="'+e.id+'_iframe_container"></div>',r='<div id="'+e.id+'_form_container"></div>',e.innerHTML=n+t+r},isLetter:function(e){return null!=e&&(1===e.length&&e.match(/[a-z_]/i))},isNumeric:function(e){return null!=e&&(1===e.length&&e.match(/[0-9]/))},as:function(e){return(e+"").replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")},generateTemplateRenderFunctionString:function(e,t,r){document.getElementById(t);var n,a=e.innerHTML,i=String(a).split("{{"),o=null,d="",l="",u="",c="",m="",s=0,T="";if(i.length<=1)return"";functionHeader='if(tableElement.id!="'+t+'")return;var generatedCode'+e.HTMLDBGUID+'="";var rowCount=rows.length;for(var currentRow=0;currentRow<rowCount;currentRow++){',l="generatedCode"+e.HTMLDBGUID+"=generatedCode"+e.HTMLDBGUID,1<(n=i.length)&&(m=d=i[0],m=String(m).replace(/(?:\r\n|\r|\n)/g,""),l+='+"'+HTMLDB.as(String(m).trim())+'"');for(var B=1;B<n;B++){for(d=i[B],s=1;"}"!=d[s-1]&&"}"!=d[s];)s++;1<(o=String(d).substr(0,s).split(".")).length?(u=o[0],c=o[1]):(u="",c=o[0]),u==t&&(u=""),""!=u?l+='+HTMLDB.getTableFieldActiveValue("'+u+'","'+c+'")':(l+='+document.getElementById("'+t+'_reader_td"+rows[currentRow].getAttribute("data-row-id")+"'+c+'").innerHTML',-1==T.indexOf(","+t+"."+c+",")&&(functionHeader+='if(!document.getElementById("'+t+'_reader_td"+rows[currentRow].getAttribute("data-row-id")+"'+c+'")){throw(new Error("An unknown field '+t+"."+c+' is used in template."));return;}',T+=","+t+"."+c+",")),m=String(d).substr(s+2),m=String(m).replace(/(?:\r\n|\r|\n)/g,""),l+='+"'+HTMLDB.as(String(m).trim())+'"'}return l+=';}document.getElementById("'+r+'").innerHTML=generatedCode'+e.HTMLDBGUID+";",functionHeader+l},generateChildTableFilterFunctionString:function(e){var t=HTMLDB.getHTMLDBParameter(e,"filter"),r="";return r="success=false;",r+=""!=t?HTMLDB.generateFilterFunctionBlock(t,e):"success=true;",r+="return success;"},generateFilterFunctionBlock:function(e,t){var r,n=-1!=t.className.indexOf("htmldb-form"),a=String(e).split("/"),i=a.length,o="",d=0,l="",u="",c="",m="||",s="HTMLDB"+(n?" form ":" table ")+t.id+" has invalid filter attribute.";if(""==e)return o;for(r=HTMLDB.getHTMLDBParameter(t,"form");d<i;){if(o+='if(undefined===object["'+(l=HTMLDB.evaluateHTMLDBExpression(a[d],r))+'"]){throw(new Error("HTMLDB'+(n?" form ":" table ")+t.id+" has unknown filter field:"+l+'"));return;}',o+="success=(success"+m,i<=++d)throw new Error(s);if(u=String(a[d]).toLowerCase(),i<=++d)throw new Error(s);switch(""==(c=HTMLDB.evaluateHTMLDBExpression(a[d],r))&&(c=0),u){case"is":case"eq":o+='(object["'+l+'"]=='+c+")";break;case"isnot":case"neq":o+='(object["'+l+'"]!='+c+")";break;case"gt":o+='(object["'+l+'"]>'+c+")";break;case"gte":o+='(object["'+l+'"]>='+c+")";break;case"lt":o+='(object["'+l+'"]<'+c+")";break;case"lte":o+='(object["'+l+'"]<='+c+")";break;case"in":o+='(-1!=String(",'+c+',").indexOf(","+object["'+l+'"]+","))';break;case"notin":o+='(-1==String(",'+c+',").indexOf(","+object["'+l+'"]+","))';break;default:throw new Error("HTMLDB"+(n?" form ":" table ")+t.id+" has invalid filter operator:"+u)}if(o+=");",++d<i){if(i<=d+3)throw new Error(s);m="or"==(m=String(a[d]).toLowerCase())?"||":"&&"}d++}return o},ss:function(e){return(e+"").replace(/\\(.?)/g,function(e,t){switch(t){case"\\":return"\\";case"0":return"\0";case"":return"";default:return t}})},ejs:function(e){return e.replace(/\n/g,"\\n").replace(/\"/g,"&quot;").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\f/g,"\\f").replace(/\f/g,"\\f").replace(/\\/g,"\\")},createNewIframeAndForm:function(e,t){var r=document.getElementById(e+"_iframe_container"),n=document.getElementById(e+"_form_container"),a=null,i=null;(a=document.createElement("iframe")).src="",a.style.display="none",a.id=e+"_iframe_"+t,a.name=e+"_iframe_"+t,a.setAttribute("data-htmldb-id",e),r.appendChild(a),(i=document.createElement("form")).src="",i.style.display="none",i.id=e+"_form_"+t,i.name=e+"_form_"+t,i.method="post",i.target=e+"_iframe_"+t,i.setAttribute("data-htmldb-id",e),n.appendChild(i)},removeIframeAndForm:function(e,t){var r=document.getElementById(e),n=document.getElementById(e+"_iframe_container"),a=document.getElementById(e+"_form_container"),i=document.getElementById(e+"_iframe_"+t),o=document.getElementById(e+"_form_"+t);i.className="deleted",o.className="deleted",clearTimeout(r.tmRemoveIframeFormTimer),r.tmRemoveIframeFormTimer=setTimeout(function(){clearTimeout(r.tmRemoveIframeFormTimer);for(var e=n.getElementsByClassName("deleted");0<e.length;)n.removeChild(e[0]);for(var t=a.getElementsByClassName("deleted");0<t.length;)a.removeChild(t[0])},1e4)},generateTDHTML:function(e,t,r,n){var a="";for(var i in r)r.hasOwnProperty(i)&&(a+='<td id="'+e.id+t+"_td"+n+i+'">'+r[i]+"</td>");return a},generateFormHTML:function(e,t,r){var n,a=document.getElementById(e.id+"_form_"+t),i="";i=-1!=r.className.indexOf("deleted")?"deleted":-1!=r.className.indexOf("updated")?"updated":"inserted";for(var o='<input class="htmldb_action" type="hidden" name="htmldb_action'+(n=a.getElementsByClassName("htmldb_action").length)+'" value="'+i+'" />',d=HTMLDB.getColumnNames(e.id,!1),l=d.length,u=r.getAttribute("data-row-id"),c=e.id+"_writer_td"+u,m=r.children.length,s={},T="",B=0;B<m;B++)s[r.children[B].id]=r.children[B].innerHTML;for(B=0;B<l;B++)s.hasOwnProperty(c+d[B])&&(T=s[c+d[B]],o+='<input class="htmldb_row" type="hidden" name="htmldb_row'+n+"_"+d[B]+'" value="'+HTMLDB.ejs(T)+'" />');a.innerHTML+=o},generateGUID:function(e){var t=new Date;return e||(e=""),e+(String(t.getUTCFullYear())+String(t.getUTCMonth()+1)+String(t.getUTCDate())+String(t.getHours())+String(t.getMinutes())+String(t.getSeconds()))+"xxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})+"xxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},evaluateHTMLDBExpression:function(e,t){var r,n=String(e).split("{{"),a=null,i="",o="",d="",l="",u=0;if(n.length<=1)return e;r=n.length;for(var c="",m=1;m<r;m++){for(i=n[m],u=1;"}"!=i[u-1]&&"}"!=i[u];)u++;1<(a=String(i).substr(0,u).split(".")).length?(o=a[0],d=a[1]):(o="",d=a[0]),void 0!==t&&""==o&&(o=t),c="$"==o[0]?HTMLDB.evaluateHTMLDBGlobalObject(o,d):""!=o?HTMLDB.getTableFieldActiveValue(o,d):"{{"+i,l=String(i).substr(u+2),l=String(l).replace(/(?:\r\n|\r|\n)/g,""),i=c+HTMLDB.as(String(l).trim()),n[m]=i}return 1<n.length&&(returnValue=n.join("")),returnValue},evaluateHTMLDBGlobalObject:function(e,t){switch(e=e.toLowerCase()){case"$url":return HTMLDB.getURLParameter(parseInt(t))}},evaluateHTMLDBExpressionWithObject:function(e,t){var r,n=String(e).split("{{"),a=null,i="",o="",d="",l=0;if(n.length<=1)return e;r=n.length;for(var u="",c=1;c<r;c++){for(i=n[c],l=1;"}"!=i[l-1]&&"}"!=i[l];)l++;1<(a=String(i).substr(0,l).split(".")).length?(a[0],o=a[1]):("",o=a[0]),u=void 0!==t[o]?t[o]:"{{"+i,d=String(i).substr(l+2),d=String(d).replace(/(?:\r\n|\r|\n)/g,""),i=u+HTMLDB.as(String(d).trim()),n[c]=i}return 1<n.length&&(returnValue=n.join("")),returnValue},exploreHTMLDBTable:function(e){for(var t=!1,r=HTMLDB.getHTMLDBParameter(e,"table");!t&&""==r;)e=e.parentNode,r=HTMLDB.getHTMLDBParameter(e,"table"),"body"==e.tagName.toLowerCase()&&(t=!0);if(parentElement=document.getElementById(r),!parentElement)throw new Error("HTMLDB table "+r+" not found.");return parentElement},exploreHTMLDBForm:function(e){var t=!1;if(-1!=e.className.indexOf("htmldb-form"))return e;for(e=e.parentNode;!t&&-1==e.className.indexOf("htmldb-form");)"body"==(e=e.parentNode).tagName.toLowerCase()&&(t=!0);if(t)throw new Error("HTMLDB form not found.");return e},exploreHTMLDBPagination:function(e){var t=!1,r=" "+e.className+" ";if(-1!=r.indexOf(" htmldb-pagination "))return e;for(r=" "+(e=e.parentNode).className+" ";!t&&-1==r.indexOf(" htmldb-pagination ");)r=" "+(e=e.parentNode).className+" ","body"==e.tagName.toLowerCase()&&(t=!0);if(t)throw new Error("HTMLDB pagination not found.");return e},doReaderIframeLoad:function(e){HTMLDB.doReaderIframeDefaultLoad(e,!1),HTMLDB.render(e.currentTarget.parentNode.parentNode)},doRefreshButtonClick:function(){HTMLDB.initializeReadQueue()},doIndexedDBUpgradeNeeded:function(){if(null==HTMLDB.indexedDBConnection)throw new Error("HTMLDB IndexedDB not initialized.");for(var e=HTMLDB.indexedDBConnection.result,t=HTMLDB.indexedDBTables.length,r=0;r<t;r++)e.createObjectStore("htmldb_"+HTMLDB.indexedDBTables[r]+"_reader",{keyPath:"id"}),e.createObjectStore("htmldb_"+HTMLDB.indexedDBTables[r]+"_writer",{keyPath:"id"})},doAddButtonClick:function(e){var t=document.getElementById(HTMLDB.getHTMLDBParameter(e.currentTarget,"form"));if(!t)throw new Error("Add button HTMLDB form not found.");HTMLDB.resetForm(t);var r=HTMLDB.convertFormToObject(t),n=HTMLDB.getHTMLDBParameter(e.currentTarget,"form-defaults");r=HTMLDB.parseObjectDefaults(r,n),HTMLDB.renderFormElementWithObject(t,r),HTMLDB.doParentElementToggle(t),t.dispatchEvent(new CustomEvent("htmldbadd",{detail:{}}))},doSaveButtonClick:function(n){var e=HTMLDB.getHTMLDBParameter(n.currentTarget,"form"),t=null;if(""!=e){if(!(t=document.getElementById(e)))throw new Error("Save button HTMLDB form not found.")}else t=HTMLDB.exploreHTMLDBForm(n.currentTarget);var a=HTMLDB.getHTMLDBParameter(t,"table");if(!document.getElementById(a))throw new Error(e+" form HTMLDB table not found.");var i=HTMLDB.convertFormToObject(t);HTMLDB.validate(a,i,function(t,e){var r=null;try{r=JSON.parse(e)}catch(e){throw new Error("HTMLDB table "+t+" could not be validated: Not valid JSON format")}0<r.errorCount?HTMLDB.showError(a,r.lastError):(HTMLDB.showMessage(a,r.lastMessage),HTMLDB.insert(a,i),n.currentTarget.dispatchEvent(new CustomEvent("htmldbsave",{detail:{}})))})},convertFormToObject:function(e){for(var t=e.querySelectorAll(".htmldb-field"),r=t.length,n=null,a={},i=0;i<r;i++)(n=t[i]).dispatchEvent(new CustomEvent("htmldbgetvalue",{detail:{}})),a[n.getAttribute("data-htmldb-field")]=HTMLDB.getInputValue(n);return a},showLoader:function(e,t){var r=document.getElementById(e),n=HTMLDB.getHTMLDBParameter(r,t+"-loader");if(""==n&&(n=HTMLDB.getHTMLDBParameter(r,"loader")),""!=n){var a=document.getElementById(n);void 0===a.depth&&(a.depth=0),a.depth+=1;1==a.depth&&-1==(" "+a.className+" ").indexOf(" active ")&&(a.className+=" active")}},hideLoader:function(e,t){var r=document.getElementById(e),n=HTMLDB.getHTMLDBParameter(r,t+"-loader");if(""==n&&(n=HTMLDB.getHTMLDBParameter(r,"loader")),""!=n){var a=document.getElementById(n);void 0===a.depth?a.depth=0:a.depth-=1,a.depth<0?a.depth=0:0==a.depth&&(a.className=String(a.className.replace(/\bactive\b/g,"")).trim())}},hideLoaders:function(){for(var e=document.body.querySelectorAll(".htmldb-table"),t=e.length,r=null,n="",a=0;a<t;a++)r=e[a],""!=(n=HTMLDB.getHTMLDBParameter(r,"read-loader"))&&(document.getElementById(n).depth=0,HTMLDB.hideLoader(r.id,"read")),""!=(n=HTMLDB.getHTMLDBParameter(r,"write-loader"))&&(document.getElementById(n).depth=0,HTMLDB.hideLoader(r.id,"write")),""!=(n=HTMLDB.getHTMLDBParameter(r,"validate-loader"))&&(document.getElementById(n).depth=0,HTMLDB.hideLoader(r.id,"validate")),""!=(n=HTMLDB.getHTMLDBParameter(r,"loader"))&&(document.getElementById(n).depth=0,HTMLDB.hideLoader(r.id,""))},showError:function(e,t){if(""!=t){for(var r=document.getElementById(e),n=document.body.querySelectorAll(".htmldb-error"),a=n.length,i=null,o=0;o<a;o++)i=n[o],HTMLDB.getHTMLDBParameter(i,"table")==e&&(i.innerHTML=t,i.dispatchEvent(new CustomEvent("htmldberror",{detail:{tableElementId:e,errorText:t}})));r.dispatchEvent(new CustomEvent("htmldberror",{detail:{errorText:t}}))}},showMessage:function(e,t){if(""!=t){for(var r=document.getElementById(e),n=document.body.querySelectorAll(".htmldb-message"),a=n.length,i=null,o=0;o<a;o++)i=n[o],HTMLDB.getHTMLDBParameter(i,"table")==e&&(i.innerHTML=t,i.dispatchEvent(new CustomEvent("htmldbmessage",{detail:{tableElementId:e,messageText:t}})));r.dispatchEvent(new CustomEvent("htmldbmessage",{detail:{messageText:t}}))}},doEditButtonClick:function(e){var t,r=null,n=HTMLDB.getHTMLDBParameter(e.currentTarget,"table"),a=HTMLDB.getHTMLDBParameter(e.currentTarget,"form");if(""==n&&""!=a){if(!(r=document.getElementById(a)))throw new Error("Edit button HTMLDB form "+a+" not found.");n=HTMLDB.getHTMLDBParameter(r,"table")}if(!(t=document.getElementById(n)))throw new Error("Edit button HTMLDB table "+n+" not found.");HTMLDB.setActiveId(t,HTMLDB.getHTMLDBParameter(e.currentTarget,"edit-id"))},doWriterIframeLoad:function(e){elDIV=e.currentTarget.parentNode.parentNode,elDIV.setAttribute("data-htmldb-loading",0),HTMLDB.hideLoader(elDIV.id,"write"),iframeWindow=top.frames[e.currentTarget.id];var t="";iframeWindow.document&&(t=String(iframeWindow.document.body.innerHTML).trim());var r=elDIV.id+"_iframe_",n=e.currentTarget.id.substr(r.length);HTMLDB.removeIframeAndForm(elDIV.id,n),elDIV.doHTMLDBWrite&&elDIV.doHTMLDBWrite(elDIV,t)},doValidatorIframeLoad:function(e){elDIV=e.currentTarget.parentNode.parentNode,elDIV.setAttribute("data-htmldb-loading",0),HTMLDB.hideLoader(elDIV.id,"validate"),iframeWindow=top.frames[e.currentTarget.id];var t="";iframeWindow.document&&(t=String(iframeWindow.document.body.innerHTML).trim());var r=elDIV.id+"_iframe_",n=iframeHTMLDB.id.substr(r.length);HTMLDB.removeIframeAndForm(elDIV.id,n),elDIV.doHTMLDBValidate&&elDIV.doHTMLDBValidate(e,t)},getInputValue:function(e){var t,r,n=null,a=0,i="";switch(t=String(e.tagName).toLowerCase(),r=String(e.getAttribute("type")).toLowerCase(),t){case"input":return"checkbox"==r?e.checked?1:0:"radio"==r?e.checked?e.value:"":e.value;case"textarea":return e.value;case"select":if(-1==e.selectedIndex)return"";i="",a=(n=e.querySelectorAll("option:checked")).length;for(var o=0;o<a;o++)""!=i&&(i+=","),i+=n[o].value;return i}return""},setInputValue:function(e,t){var r=String(e.tagName).toLowerCase(),n=String(e.getAttribute("type")).toLowerCase();switch(r){case"input":"checkbox"==n?e.checked="1"==t:"radio"==n?e.value==t&&(e.checked=!0):e.value=t;break;case"textarea":e.innerHTML=t;break;case"select":e.value=t}},removeReadQueueCallbacks:function(){HTMLDB.readQueueCallbacks=[]},callReadQueueCallbacks:function(e){if(void 0!==HTMLDB.readQueueCallbacks[e.id])for(;0<HTMLDB.readQueueCallbacks[e.id].length;)HTMLDB.readQueueCallbacks[e.id].shift()()},doReaderIframeDefaultLoad:function(t,e){var r=t.currentTarget,n=r.parentNode.parentNode,a=r.parentNode.parentNode.id,i=document.getElementById(a+"_reader_tbody"),o=document.getElementById(a+"_reader_thead");iframeWindow=top.frames[r.id];var d="";if(iframeWindow.document&&(d=String(iframeWindow.document.body.innerHTML).trim()),""!=d){var l=[];try{l=JSON.parse(d)}catch(e){throw new Error("HTMLDB table "+n.id+" could not be read: Not valid JSON format from URL "+t.currentTarget.src)}var u=l.c,c=l.r.length,m=l.c.length,s="",T="",B=null;for(T="<tr>",j=0;j<m;j++)T+="<th>"+u[j]+"</th>";T+="</tr>";for(var L=0,D=0;D<c;D++){for((B=document.getElementById(a+"_reader_tr"+l.r[D][0]))&&B.parentNode.removeChild(B),0==D&&(L=l.r[D][0]),s+='<tr class="refreshed" data-row-id="'+l.r[D][0]+'" id="'+a+"_reader_tr"+l.r[D][0]+'">',j=0;j<m;j++)s+='<td id="'+a+"_reader_td"+l.r[D][0]+u[j]+'">'+l.r[D][j]+"</td>";s+="</tr>"}o.innerHTML=T,i.innerHTML+=s,document.getElementById(n.id+"_writer_thead").innerHTML=T,n.setAttribute("data-htmldb-active-id",L)}var M=n.id+"_iframe_",H=r.id.substr(M.length);HTMLDB.removeIframeAndForm(n.id,H),!1===e&&n.doHTMLDBRead?n.doHTMLDBRead(n):!0===e&&n.doHTMLDBReadAll&&n.doHTMLDBReadAll(n),n.setAttribute("data-htmldb-loading",0),HTMLDB.hideLoader(a,"read"),setTimeout(function(){HTMLDB.callReadQueueCallbacks(n),HTMLDB.removeFromReadingQueue(n.id),HTMLDB.processReadQueue()},150)}};HTMLDB.initialize(),function(){if("function"==typeof window.CustomEvent)return;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var r=document.createEvent("CustomEvent");return r.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),r}e.prototype=window.Event.prototype,window.CustomEvent=e}();