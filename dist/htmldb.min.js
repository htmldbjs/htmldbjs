var HTMLDB={readQueue:[],readingQueue:[],readQueueCallbacks:[],activeFormFields:[],activeToggleFields:[],indexedDB:null,indexedDBConnection:null,indexedDBTables:[],pausing:!1,initialize:function(){HTMLDB.initializeHTMLDBSelects(),HTMLDB.initializeHTMLDBIndexedDB(function(){HTMLDB.initializeHTMLDBTables(),HTMLDB.initializeHTMLDBFormTables(),HTMLDB.initializeHTMLDBTemplates(),HTMLDB.initializeHTMLDBButtons(),HTMLDB.initializeHTMLDBInputs(),HTMLDB.initializeHTMLDBPaginations(),HTMLDB.initializeHTMLDBSections(),HTMLDB.initializeHTMLDBForms(),HTMLDB.initializeHTMLDBToggles(),HTMLDB.initializeReadQueue(),HTMLDB.resetWriterLoop()})},stop:function(e){e&&(e.setAttribute("data-htmldb-loading",0),HTMLDB.hideLoaders())},read:function(e,t){if(!e)throw new Error("HTMLDB table "+e.getAttribute("id")+" will be readed, but not found.");var r=e.getAttribute("id");if(parseInt(e.getAttribute("data-htmldb-loading"))>0)return!0;if(""!=HTMLDB.getHTMLDBParameter(e,"table"))return HTMLDB.readChildTable(e,t);var a=HTMLDB.e(HTMLDB.getHTMLDBParameter(e,"form")),n=HTMLDB.getHTMLDBParameter(e,"read-url");if(""==(n=HTMLDB.evaluateHTMLDBExpression(n,a)))throw new Error("HTMLDB table "+r+" read URL attribute is empty.");var i=HTMLDB.e(r+"_reader_tbody");HTMLDB.isHTMLDBParameter(e,"read-incremental")||(i.innerHTML="");var o=HTMLDB.generateDateTimeGUID("read");HTMLDB.createNewIframeAndForm(e,o);var l=r+"_iframe_"+o;if(!HTMLDB.e(l))throw new Error("HTMLDB table "+r+" target iframe not found.");var d=HTMLDB.e(l),u=d.cloneNode(!0);d.parentNode.replaceChild(u,d),d=u,e.setAttribute("data-htmldb-loading",1),HTMLDB.showLoader(e,"read");var T=HTMLDB.doReaderIframeLoad;t&&(T=function(e){var r=HTMLDB.getEventTarget(e).parentNode.parentNode;r.setAttribute("data-htmldb-loading",0),HTMLDB.hideLoader(r,"read"),HTMLDB.doReaderIframeDefaultLoad(e,!0),t(r)}),d.addEventListener?d.addEventListener("load",T,!0):d.attachEvent&&d.attachEvent("onload",T);try{var s=new Date;-1==n.indexOf("?")?n+="?nocache="+s.getTime():n+="&nocache="+s.getTime(),d.src=n}catch(e){throw new Error("An error occured while reading HTMLDB table "+r+".")}return!0},updateTableFilterFunction:function(e){if(e.filterFunction=null,HTMLDB.hasHTMLDBParameter(e,"filter")){var t=HTMLDB.generateTableFilterFunctionString(e);try{e.filterFunction=new Function("object",t)}catch(t){throw new Error("HTMLDB table "+e.id+" filter function could not be created.")}}return!0},validate:function(e,t,r){if(!e)throw new Error("HTMLDB table "+e.getAttribute("id")+" will be validated, but not found.");var a=e.getAttribute("id");if(parseInt(e.getAttribute("data-htmldb-loading"))>0)throw new Error("HTMLDB table "+a+" is loading right now.");var n=[];if(void 0===t[0]){if(null==t.id)throw new Error("HTMLDB table "+a+" validation object id attribute not found.");n.push(t)}else{if(0==(n=t).length)throw new Error("HTMLDB table "+a+" validation object array is empty.");if(null==(t=n[0]).id)throw new Error("HTMLDB table "+a+" validation object id attribute not found.")}HTMLDB.validateLocal(e,n,function(e,t){var a=null;try{a=JSON.parse(String(decodeURIComponent(t)).trim())}catch(t){throw new Error("HTMLDB table "+e.getAttribute("id")+" could not be validated: Not valid JSON format")}if(a.errorCount>0)r?r(e,t):HTMLDB.showError(e,a.lastError);else{var i=HTMLDB.getHTMLDBParameter(e,"validate-url");""!=(i=HTMLDB.evaluateHTMLDBExpression(i))&&navigator.onLine?HTMLDB.validateRemote(e,n,r):r&&r(e,t)}})},validateLocal:function(e,t,r){for(var a=HTMLDB.q(".htmldb-table-validation"),n=a.length,i=null,o={errorCount:0,messageCount:0,lastError:"",lastMessage:""},l={errorCount:0,messageCount:0,lastError:"",lastMessage:""},d=t.length,u=0;u<d;u++)for(var T=0;T<n;T++)i=a[T],HTMLDB.getHTMLDBParameter(i,"table")==e.getAttribute("id")&&(l=HTMLDB.checkTableValidation(e,t[u],i),o.errorCount+=l.errorCount,o.messageCount+=l.messageCount,o.lastError+=l.lastError,o.lastMessage+=l.lastMessage);r&&r(e,JSON.stringify(o))},checkTableValidation:function(e,t,r){for(var a=r.children,n=a.length,i=null,o="",l="",d={errorCount:0,messageCount:0,lastError:"",lastMessage:""},u=0;u<n;u++)if(i=a[u],""!=(o=HTMLDB.getHTMLDBParameter(i,"validation"))){l="success=false;",l+=HTMLDB.generateFilterFunctionBlock(o,e),l+="return success;";try{new Function("object",l)(t)&&(d.errorCount+=1,d.lastError+=i.innerHTML)}catch(t){throw new Error("HTMLDB table "+e.getAttribute("id")+" validation function could not be created.")}}return d},validateRemote:function(e,t,r){var a=e.getAttribute("id"),n=HTMLDB.getHTMLDBParameter(e,"overridden-validate-url"),i=HTMLDB.getHTMLDBParameter(e,"validate-url");if(""==(i=HTMLDB.evaluateHTMLDBExpression(i)))throw new Error("HTMLDB table "+a+" validate URL attribute is empty.");""!=n&&(i=n,HTMLDB.setHTMLDBParameter(e,"overridden-validate-url",""));var o=HTMLDB.generateDateTimeGUID("validate");HTMLDB.createNewIframeAndForm(e,o);var l=a+"_iframe_"+o;if(!HTMLDB.e(l))return!1;var d=HTMLDB.e(a+"_form_"+o),u=HTMLDB.e(l),T=u.cloneNode(!0);u.parentNode.replaceChild(T,u),u=T,e.setAttribute("data-htmldb-loading",1),HTMLDB.showLoader(e,"validate");var s=HTMLDB.doValidatorIframeLoad;r&&(s=function(e){var t=HTMLDB.getEventTarget(e).parentNode.parentNode;t.setAttribute("data-htmldb-loading",0),HTMLDB.hideLoader(t,"validate"),iframeWindow=top.frames[a+"_iframe_"+o];var n="";iframeWindow.document&&(n=String(iframeWindow.document.body.innerHTML).trim()),HTMLDB.removeIframeAndForm(t,o),r(t,n)}),u.addEventListener?u.addEventListener("load",s,!0):u.attachEvent&&u.attachEvent("onload",s),d.innerHTML="";for(var L="",c="",D=t.length,M=null,B=0;B<D;B++)for(L in c='<input class="htmldb_action" type="hidden" name="htmldb_action'+B+'" value="'+(0==(M=t[B]).id?"inserted":"updated")+'" />',L="",M)M.hasOwnProperty(L)&&(c+='<input class="htmldb_row" type="hidden" name="htmldb_row'+B+"_"+L+"\" value='"+HTMLDB.escapeSingleQuote(M[L])+"' />");d.innerHTML=c,d.action=i;try{d.submit()}catch(e){}},write:function(e,t,r){if(!e)throw new Error("HTMLDB table "+e.getAttribute("id")+" will be readed, but not found.");var a=e.getAttribute("id");if(parseInt(e.getAttribute("data-htmldb-loading"))>0)throw new Error("HTMLDB table "+a+" is loading right now.");if(!0===t)return clearTimeout(e.HTMLDBWriteTimer),lWriteDelay=parseInt(e.getAttribute("data-write-delay")),isNaN(lWriteDelay)&&(lWriteDelay=2e3),void(e.HTMLDBWriteTimer=setTimeout(function(){clearTimeout(e.HTMLDBWriteTimer),HTMLDB.write(e,!1,r)},lWriteDelay));var n=HTMLDB.getHTMLDBParameter(e,"write-url");if(""==(n=HTMLDB.evaluateHTMLDBExpression(n)))throw new Error("HTMLDB table "+a+" write URL attribute is empty.");var i=HTMLDB.generateDateTimeGUID("write");HTMLDB.createNewIframeAndForm(e,i);var o=a+"_iframe_"+i;if(HTMLDB.e(o)){var l=HTMLDB.e(a+"_writer_tbody").children,d=null,u=l.length,T=HTMLDB.e(a+"_form_"+i),s=HTMLDB.e(o),L=s.cloneNode(!0);s.parentNode.replaceChild(L,s),s=L,e.setAttribute("data-htmldb-loading",1),HTMLDB.showLoader(e,"write");var c=HTMLDB.doWriterIframeLoad;r&&(c=function(e){var t=HTMLDB.getEventTarget(e).parentNode.parentNode;iframeWindow=top.frames[a+"_iframe_"+i];var n="";iframeWindow.document&&(n=String(iframeWindow.document.body.innerHTML).trim()),HTMLDB.doWriterIframeLoad(e),r(t,n);var o=HTMLDB.getHTMLDBParameter(t,"redirect");""!=(o=HTMLDB.evaluateHTMLDBExpression(o))&&(t.dispatchEvent(new CustomEvent("htmldbbeforeredirect",{detail:{redirectURL:o}})),window.location.href=o)}),s.addEventListener?s.addEventListener("load",c,!0):s.attachEvent&&s.attachEvent("onload",c),T.innerHTML="";for(var D=0;D<u;D++)(d=l[D])&&(-1==d.className.indexOf("updated")&&-1==d.className.indexOf("inserted")&&-1==d.className.indexOf("deleted")||(HTMLDB.generateFormHTML(e,i,d),r||(d.parentNode.removeChild(d),D--)));T.action=n;try{T.submit()}catch(e){}}},readLocal:function(e,t){if(!e)throw new Error("HTMLDB table "+e.getAttribute("id")+" will be readed, but not found.");var r=e.getAttribute("id");if(parseInt(e.getAttribute("data-htmldb-loading"))>0)throw new Error("HTMLDB table "+r+" is loading right now.");return""!=HTMLDB.getHTMLDBParameter(e,"table")?HTMLDB.readChildTable(e,t):(e.setAttribute("data-htmldb-loading",1),HTMLDB.showLoader(e,"read"),e.setAttribute("data-htmldb-loading",0),HTMLDB.hideLoader(e,"read"),HTMLDB.initializeLocalTable(e,t),!0)},get:function(e,t){if(!e)return{};var r=e.getAttribute("id"),a=HTMLDB.e(r+"_reader_tr"+t);return a?HTMLDB.convertRowToObject(e,a):{}},insert:function(e,t,r){if(e){var a=e.getAttribute("id");void 0===r&&(r="");var n=HTMLDB.e(a+"_writer_tr"+t.id);if(!HTMLDB.isNewObject(t)||null!=n)return HTMLDB.update(e,t.id,t,r);var i=HTMLDB.e(a+"_writer_tbody"),o=HTMLDB.generateDateTimeGUID(),l='<tr class="inserted'+(""!=r?" "+r:"")+'" data-row-id="n'+o+'" id="'+e.getAttribute("id")+"_writer_trn"+o+'">';if(l+=HTMLDB.generateTDHTML(e,"_writer",t,"n"+o),l+="</tr>",i.innerHTML+=l,HTMLDB.isHTMLDBParameter(e,"local")){i=HTMLDB.e(a+"_reader_tbody"),t.id="n"+o,l='<tr class="inserted'+(""!=r?" "+r:"")+'" data-row-id="n'+o+'" id="'+e.getAttribute("id")+"_reader_trn"+o+'">',l+=HTMLDB.generateTDHTML(e,"_reader",t,"n"+o),l+="</tr>";var d=!1;e.filterFunction&&(e.filterFunction(t)||(d=!0)),d||(i.innerHTML+=l),HTMLDB.updateLocal(e,t.id,t),HTMLDB.render(e)}}},update:function(e,t,r,a){if(e){var n=e.getAttribute("id");void 0===a&&(a=""),r.id=t;var i=HTMLDB.e(n+"_writer_tr"+t);if(HTMLDB.isNewObject(r)&&null==i)return HTMLDB.insert(e,r,a);var o=HTMLDB.e(n+"_writer_tbody"),l=HTMLDB.generateTDHTML(e,"_writer",r,t),d="",u="";if(i?(i.innerHTML=l,-1==i.className.indexOf("inserted")&&(i.className="updated"+(""!=a?" "+a:""))):(d='<tr class="updated'+(""!=a?" "+a:"")+'" data-row-id="'+t+'" id="'+e.getAttribute("id")+"_writer_tr"+t+'">',u="</tr>",o.innerHTML+=d+l+u),HTMLDB.isHTMLDBParameter(e,"local")){if(!(i=HTMLDB.e(n+"_reader_tr"+t)))return;o=HTMLDB.e(n+"_reader_tbody"),l=HTMLDB.generateTDHTML(e,"_reader",r,t);var T=!1;e.filterFunction&&(e.filterFunction(r)||(o.removeChild(i),T=!0)),T||(i.innerHTML=l),HTMLDB.updateLocal(e,t,r),HTMLDB.render(e)}}},updateLocal:function(e,t,r,a){if(null==HTMLDB.indexedDBConnection)throw new Error("HTMLDB IndexedDB not initialized.");var n=e.getAttribute("id"),i=HTMLDB.indexedDBConnection.result,o=i.transaction("htmldb_"+n+"_reader","readwrite"),l=i.transaction("htmldb_"+n+"_writer","readwrite"),d=o.objectStore("htmldb_"+n+"_reader"),u=l.objectStore("htmldb_"+n+"_writer");r.id=t;var T=!1;return e.filterFunction&&(e.filterFunction(r)||(T=!0)),T?d.delete(HTMLDB.addLeadingZeros(t,20)):d.put(r,HTMLDB.addLeadingZeros(t,20)),!0!==a&&u.put(r,HTMLDB.addLeadingZeros(t,20)),HTMLDB.updateReadQueueByParentTable(e),HTMLDB.updateReadQueueWithParameter(e,"refresh-table"),HTMLDB.processReadQueue(),!0},delete:function(e,t,r){if(e){var a=e.getAttribute("id");void 0===r&&(r="");var n=HTMLDB.e(a+"_writer_tr"+t);n&&(n.className="deleted"+(""!=r?" "+r:""))}},render:function(e,t){if(!HTMLDB.pausing){var r=HTMLDB.getActiveId(e);HTMLDB.renderTemplates(e),HTMLDB.renderSelects(e),HTMLDB.renderSections(e),HTMLDB.renderForms(e),""!=r&&(HTMLDB.renderPaginations(e),HTMLDB.renderCheckboxGroups(e)),t?t():e.doHTMLDBRender&&e.doHTMLDBRender(e)}},isLoading:function(){for(var e=HTMLDB.q(".htmldb-table"),t=e.length,r=null,a=0;a<t;a++)if(r=e[a],1==parseInt(HTMLDB.getHTMLDBParameter(r,"loading")))return!0;return!1},isIdle:function(){if(HTMLDB.isLoading())return!1;for(var e=HTMLDB.q(".htmldb-table"),t=e.length,r=null,a=0;a<t;a++)if(r=e[a],!HTMLDB.isHTMLDBParameter(r,"local")&&HTMLDB.e(r.getAttribute("id")+"_writer_tbody").children.length>0)return!1;return!0},getColumnNames:function(e,t){for(var r=HTMLDB.e(e.getAttribute("id")+"_reader_thead").children[0].children,a=null,n=r.length,i=new Array,o=0;o<n;o++)a=r[o],i.push(a.innerHTML);return!0===t&&i.sort(),i},setColumnNames:function(e,t){columnContent="<tr>";var r=e.getAttribute("id");for(var a in t)t.hasOwnProperty(a)&&(columnContent+="<th>"+a+"</th>");columnContent+="</tr>",HTMLDB.e(r+"_reader_thead").innerHTML=columnContent,HTMLDB.e(r+"_writer_thead").innerHTML=columnContent},getTableFieldActiveValue:function(e,t){if(!e)throw new Error("HTMLDB table/form "+e.getAttribute("id")+" is referenced, but not found.");var r=e.getAttribute("id");if(-1!=e.className.indexOf("htmldb-form"))return HTMLDB.getFormFieldActiveValue(e,t);var a=HTMLDB.getHTMLDBParameter(e,"active-id");columnElementId=r+"_reader_td"+a+t;return HTMLDB.e(columnElementId)?HTMLDB.e(r+"_reader_td"+a+t).innerHTML:""},getFormFieldActiveValue:function(e,t){var r=e.getAttribute("id"),a=HTMLDB.convertFormToObject(e);if(void 0===a[t])throw new Error("HTMLDB form "+r+" field "+t+" not found.");return a[t]},setActiveId:function(e,t,r){e.setAttribute("data-htmldb-active-id",t),!0===r||HTMLDB.pausing||(HTMLDB.renderSelects(e),""!=t&&(HTMLDB.renderPaginations(e),HTMLDB.renderSections(e),HTMLDB.renderForms(e),HTMLDB.renderCheckboxGroups(e)),e.doHTMLDBRender&&e.doHTMLDBRender(e),HTMLDB.updateReadQueueByParentTable(e))},updateReadQueueByParentTable:function(e){var t=HTMLDB.extractChildTables(),r=0,a=null;if(void 0!==t[e.getAttribute("id")]){r=(t=t[e.getAttribute("id")]).length;for(var n=0;n<r;n++)a=HTMLDB.e(t[n]),HTMLDB.updateReadQueue(a,!0);r>0&&HTMLDB.processReadQueue()}},getActiveId:function(e){return e.getAttribute("data-htmldb-active-id")},getTableRowCount:function(e){return HTMLDB.getReaderTableCount(e)+HTMLDB.getWriterTableCount(e)},getReaderTableRowCount:function(e){var t=HTMLDB.e(e.getAttribute("id")+"_reader_tbody");return t?t.children.length:0},getWriterTableRowCount:function(e){var t=HTMLDB.e(e.getAttribute("id")+"_writer_tbody");return t?t.children.length:0},resetWriterLoop:function(){var e=document.body.HTMLDBWriterTimer;clearTimeout(e),e=setTimeout(function(){HTMLDB.writeTables(),HTMLDB.resetWriterLoop()},2e3),document.body.HTMLDBWriterTimer=e},writeTables:function(){if(!HTMLDB.pausing)for(var e=HTMLDB.q(".htmldb-table"),t=e.length,r=null,a=null,n=0;n<t;n++)r=e[n],HTMLDB.isHTMLDBParameter(r,"read-only")||HTMLDB.e(r.getAttribute("id")+"_writer_tbody")&&(HTMLDB.isHTMLDBParameter(r,"local")||parseInt(HTMLDB.getHTMLDBParameter(r,"loading"))>0||0!=(a=HTMLDB.e(r.getAttribute("id")+"_writer_tbody")).children.length&&(a.querySelectorAll("tr.updating").length>0||(HTMLDB.markRows(a,"updating"),HTMLDB.write(r,!1,function(e,t){var r=HTMLDB.e(e.getAttribute("id")+"_writer_tbody");HTMLDB.deleteMarkedRows(r,"updating"),0==r.children.length?HTMLDB.doTableWrite(e):HTMLDB.writeTables()}))))},canWriteTable:function(e){var t=HTMLDB.e(e.getAttribute("id")+"_writer_tbody");return!!t&&0!=t.children.length},doTableWrite:function(e){if(HTMLDB.isHTMLDBParameter(e,"write-only"))return!0;var t=HTMLDB.getHTMLDBParameter(e,"redirect");""!=t&&(e.dispatchEvent(new CustomEvent("htmldbbeforeredirect",{detail:{redirectURL:t}})),window.location.href=t),HTMLDB.e(e.getAttribute("id")+"_reader_tbody").innerHTML="",HTMLDB.updateReadQueue(e)},updateReadQueue:function(e,t){var r,a=[],n="",i=0;a.push(e.getAttribute("id"));var o=HTMLDB.extractChildTables();void 0!==o[e.getAttribute("id")]&&(a=a.concat(o[e.getAttribute("id")])),r=a.length;for(var l=0;l<r;l++)n=a[l],i=parseInt(HTMLDB.getHTMLDBParameter(HTMLDB.e(n),"priority")),void 0===HTMLDB.readQueue[i]&&(HTMLDB.readQueue[i]=[]),HTMLDB.readQueue[i].push(n);!0!==t&&HTMLDB.processReadQueue()},updateReadQueueCallbacks:function(e,t){void 0===HTMLDB.readQueueCallbacks[e.getAttribute("id")]&&(HTMLDB.readQueueCallbacks[e.getAttribute("id")]=[]);var r=HTMLDB.readQueueCallbacks[e.getAttribute("id")].length;HTMLDB.readQueueCallbacks[e.getAttribute("id")][r]=t},isInReadQueue:function(e){for(var t in HTMLDB.readQueue)if(-1!=HTMLDB.readQueue[t].indexOf(e.getAttribute("id")))return!0;return!1},markRows:function(e,t){for(var r=e.children,a=r.length,n=null,i=0;i<a;i++)-1==(n=r[i]).className.indexOf(t)&&(""!=n.className&&(n.className+=" "),n.className+=t)},deleteMarkedRows:function(e,t){for(var r=e.getElementsByClassName(t);r.length>0;)e.removeChild(r[0])},renderTemplates:function(e){for(var t=HTMLDB.e(e.getAttribute("id")+"_reader_tbody").children,r=HTMLDB.q(".htmldb-template"),a=r.length,n=null,i=e.HTMLDBTemplateTargets.length,o="",l=0;l<i;l++)o=e.HTMLDBTemplateTargets[l],HTMLDB.e(o)&&(HTMLDB.e(o).innerHTML="");for(l=0;l<a;l++)n=r[l],e.getAttribute("id")==HTMLDB.getHTMLDBParameter(n,"table")&&n.renderFunction&&(n.renderFunction(e,t),HTMLDB.initializeHTMLDBButtons(null),n.dispatchEvent(new CustomEvent("htmldbrender",{detail:{targets:e.HTMLDBTemplateTargets}})))},renderSections:function(e){for(var t=HTMLDB.q(".htmldb-section"),r=t.length,a=null,n=0;n<r;n++)a=t[n],HTMLDB.getHTMLDBParameter(a,"table")==e.getAttribute("id")&&(HTMLDB.renderSectionElement(a),HTMLDB.doParentElementToggle(a))},renderForms:function(e){for(var t=HTMLDB.q(".htmldb-form"),r=t.length,a=null,n=0;n<r;n++)a=t[n],HTMLDB.getHTMLDBParameter(a,"table")==e.getAttribute("id")&&HTMLDB.renderFormElement(a);HTMLDB.initializeHTMLDBEditButtons(null,e),HTMLDB.initializeHTMLDBInputs()},renderSelects:function(e){for(var t=HTMLDB.q("select.htmldb-field"),r=t.length,a=null,n=0;n<r;n++)a=t[n],HTMLDB.getHTMLDBParameter(a,"option-table")==e.getAttribute("id")&&HTMLDB.renderSelectElement(a)},renderPaginations:function(e){for(var t=HTMLDB.q(".htmldb-pagination"),r=t.length,a=null,n=0;n<r;n++)a=t[n],HTMLDB.getHTMLDBParameter(a,"table")==e.getAttribute("id")&&HTMLDB.renderPaginationElement(a)},renderCheckboxGroups:function(e){for(var t=HTMLDB.q(".htmldb-checkbox-group"),r=t.length,a=null,n=0;n<r;n++)a=t[n],HTMLDB.getHTMLDBParameter(a,"table")==e.getAttribute("id")&&HTMLDB.renderCheckboxGroup(a)},renderCheckboxGroup:function(e){for(var t=e.querySelectorAll(".htmldb-checkbox,.htmldb-checkbox-all"),r=t.length,a=null,n=0;n<r;n++)(a=t[n]).checked=!1,a.addEventListener?a.addEventListener("click",HTMLDB.doCheckboxClick,!0):a.attachEvent&&a.attachEvent("onclick",HTMLDB.doCheckboxClick)},doCheckboxClick:function(e){var t=HTMLDB.getEventTarget(e),r=t.checked,a=HTMLDB.exploreHTMLDBCheckboxGroup(t),n=a.querySelectorAll(".htmldb-checkbox,.htmldb-checkbox-all"),i=n.length,o=a.querySelectorAll(".htmldb-checkbox:checked").length,l=a.querySelectorAll(".htmldb-checkbox-all"),d=l.length,u=!1;if(-1!=t.className.indexOf("htmldb-checkbox-all"))for(var T=0;T<i;T++)(t=n[T]).checked=r;else{u=i==o+1;for(T=0;T<d;T++)(t=l[T]).checked=u}t.dispatchEvent(new CustomEvent("htmldbclick",{detail:{}}))},initializeHTMLDBIndexedDB:function(e){HTMLDB.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB,HTMLDB.hasLocalTable()?(HTMLDB.indexedDBConnection=indexedDB.open("htmldb",1),HTMLDB.indexedDBConnection.onupgradeneeded=HTMLDB.doIndexedDBUpgradeNeeded,HTMLDB.indexedDBConnection.onsuccess=e):e&&e()},initializeHTMLDBTables:function(){for(var e=HTMLDB.q(".htmldb-table"),t=e.length,r=null,a=0,n=0;n<t;n++)r=e[n],HTMLDB.validateHTMLDBTableDefinition(r);for(n=0;n<t;n++)r=e[n],HTMLDB.createHelperElements(r),r.style.display="none",r.setAttribute("data-htmldb-loading",0),r.HTMLDBTemplateTargets=[],a=parseInt(HTMLDB.getHTMLDBParameter(r,"priority")),isNaN(a)&&(a=0,r.setAttribute("data-htmldb-priority",a));var i=HTMLDB.extractParentTables();for(n=0;n<t;n++)0!=i[(r=e[n]).getAttribute("id")]&&(HTMLDB.getHTMLDBParameter(r,"priority")>HTMLDB.getMaxPriority(i[r.getAttribute("id")])||(a=HTMLDB.getMaxPriority(i[r.getAttribute("id")])+1,r.setAttribute("data-htmldb-priority",a)))},hasLocalTable:function(){var e=HTMLDB.q(".htmldb-table"),t=e.length,r=null,a=!1;HTMLDB.indexedDBTables=[];for(var n=0;n<t;n++)r=e[n],HTMLDB.isHTMLDBParameter(r,"local")&&(HTMLDB.indexedDBTables.push(r.getAttribute("id")),a=!0);return a},initializeHTMLDBFormTables:function(){var e=HTMLDB.q(".htmldb-table"),t=e.length,r=null,a="",n=null,i="";HTMLDB.activeFormFields=[];for(var o=0;o<t;o++)if(r=e[o],""!=(a=HTMLDB.getHTMLDBParameter(r,"form"))){if(!(n=HTMLDB.e(a)))throw new Error("HTMLDB form "+a+" referenced by "+r.getAttribute("id")+", but not found.");for(var l in void 0===HTMLDB.activeFormFields[a]&&(HTMLDB.activeFormFields[a]=[]),i=HTMLDB.getHTMLDBParameter(r,"read-url")+HTMLDB.getHTMLDBParameter(r,"filter"),HTMLDB.convertFormToObject(n))-1!=i.indexOf("{{"+l+"}}")&&(void 0===HTMLDB.activeFormFields[a][l]&&(HTMLDB.activeFormFields[a][l]=[]),HTMLDB.activeFormFields[a][l].push(r.getAttribute("id")))}},initializeHTMLDBTemplates:function(){for(var e=HTMLDB.q(".htmldb-template"),t=e.length,r=null,a="",n="",i="",o=0;o<t;o++){(r=e[o]).HTMLDBGUID=HTMLDB.generateGUID(),HTMLDB.validateHTMLDBTemplateDefinition(r),a=HTMLDB.getHTMLDBParameter(r,"table"),n=HTMLDB.getHTMLDBParameter(r,"template-target"),i=HTMLDB.generateTemplateRenderFunctionString(r,a,n);try{r.renderFunction=new Function("tableElement","rows",i)}catch(e){throw new Error("HTMLDB template (index:"+o+") render function could not be created.")}}},initializeHTMLDBButtons:function(e){HTMLDB.initializeHTMLDBRefreshButtons(e),HTMLDB.initializeHTMLDBAddButtons(e),HTMLDB.initializeHTMLDBEditButtons(e),HTMLDB.initializeHTMLDBSaveButtons(e),HTMLDB.initializeHTMLDBSortButtons(e)},initializeHTMLDBInputs:function(e){HTMLDB.initializeHTMLDBSaveInputs(e)},initializeHTMLDBPaginations:function(e){for(var t=HTMLDB.q(".htmldb-pagination"),r=t.length,a=null,n=0;n<r;n++)a=t[n],HTMLDB.validateHTMLDBPaginationDefinition(a)},initializeLocalTable:function(e,t){if(null==HTMLDB.indexedDBConnection)throw new Error("HTMLDB IndexedDB not initialized.");var r=e.getAttribute("id"),a=HTMLDB.indexedDBConnection.result,n=a.transaction("htmldb_"+r+"_reader","readwrite"),i=a.transaction("htmldb_"+r+"_writer","readwrite"),o=n.objectStore("htmldb_"+r+"_reader"),l=i.objectStore("htmldb_"+r+"_writer"),d=o.getAll();t&&(void 0===e.HTMLDBInitials?e.HTMLDBInitials={functionDone:t}:e.HTMLDBInitials.functionDone=t),d.onsuccess=function(e){var t=HTMLDB.getEventTarget(e),r=t.source.name.slice(7,-7),a=HTMLDB.e(r);HTMLDB.initializeLocalTableRows(a,"reader",t.result),setTimeout(function(){HTMLDB.removeFromReadingQueue(a),HTMLDB.callReadQueueCallbacks(a),HTMLDB.updateReadQueueByParentTable(a),HTMLDB.processReadQueue(),a.dispatchEvent(new CustomEvent("htmldbread",{detail:{remote:!1,local:!0}})),a.dispatchEvent(new CustomEvent("htmldbreadlocal",{detail:{remote:!1,local:!0}}))},150),null!=a.HTMLDBInitials&&a.HTMLDBInitials.functionDone&&(a.HTMLDBInitials.functionDone(),a.HTMLDBInitials.functionDone=void 0),HTMLDB.render(a)};var u=l.getAll();u.onsuccess=function(e){var t=HTMLDB.getEventTarget(e).source.name.slice(7,-7),r=HTMLDB.e(t);HTMLDB.initializeLocalTableRows(r,"writer",u.result)}},initializeLocalTableRows:function(e,t,r){var a=r.length,n=null,i=0,o="",l=0,d=!1,u="writer"==t,T=!1;HTMLDB.updateTableFilterFunction(e);for(var s=0;s<a;s++)i=(n=r[s]).id,e.filterFunction&&!e.filterFunction(n)||(T=HTMLDB.isNewObject(n),o+='<tr class="'+(u?T?"inserted":"updated":"refreshed")+'" data-row-id="'+i+'" id="'+e.getAttribute("id")+"_"+t+"_tr"+i+'">',o+=HTMLDB.generateTDHTML(e,"_"+t,n,i),o+="</tr>",d||(l=i,HTMLDB.setColumnNames(e,n),d=!0));HTMLDB.e(e.getAttribute("id")+"_"+t+"_tbody").innerHTML=o,"reader"==t&&e.setAttribute("data-htmldb-active-id",l)},resetForm:function(e){var t=e.elements,r=t.length,a="";e.reset();for(var n=0;n<r;n++){switch(t[n].type.toLowerCase()){case"text":case"password":case"hidden":t[n].value="";break;case"textarea":t[n].innerHTML="";break;case"radio":case"checkbox":t[n].checked&&(t[n].checked=!1);break;case"select-one":case"select-multi":t[n].selectedIndex=-1,null!=t[n].HTMLDBInitials&&(t[n].HTMLDBInitials.previousOptionValueCSV=void 0,t[n].HTMLDBInitials.selectNewOption=void 0)}HTMLDB.hasHTMLDBParameter(t[n],"reset-value")?(a=HTMLDB.evaluateHTMLDBExpression(HTMLDB.getHTMLDBParameter(t[n],"reset-value")),HTMLDB.setInputValue(t[n],a),t[n].dispatchEvent(new CustomEvent("htmldbreset",{detail:{value:a}}))):t[n].dispatchEvent(new CustomEvent("htmldbreset",{detail:{value:""}}))}e.HTMLDBFormToObjectCache=void 0,e.dispatchEvent(new CustomEvent("htmldbreset",{detail:{}}))},initializeHTMLDBSections:function(){for(var e=HTMLDB.q(".htmldb-section"),t=e.length,r=0;r<t;r++)HTMLDB.storeSectionElementTemplates(e[r])},storeSectionElementTemplates:function(e){if(!e)return!1;e.HTMLDBInitials={attributes:[],content:""};for(var t=e.attributes.length,r=null,a=0;a<t;a++)-1!=(r=e.attributes[a]).value.indexOf("{{")&&e.HTMLDBInitials.attributes.push({name:r.name,value:r.value});0==e.HTMLDBInitials.attributes.length&&(e.HTMLDBInitials.attributes=void 0);var n=e.children.length,i=null;for(a=0;a<n;a++)i=e.children[a],HTMLDB.storeSectionElementTemplates(i);0==n&&(-1!=e.innerHTML.indexOf("{{")?e.HTMLDBInitials.content=e.innerHTML:e.HTMLDBInitials.content=void 0),void 0===e.HTMLDBInitials.attributes&&void 0===e.HTMLDBInitials.content&&(e.HTMLDBInitials=void 0)},initializeHTMLDBForms:function(){for(var e=HTMLDB.q(".htmldb-form"),t=e.length,r=null,a=0;a<t;a++)r=e[a],HTMLDB.initializeHTMLDBFormFields(r)},initializeHTMLDBFormFields:function(e){for(var t=e.querySelectorAll(".htmldb-field"),r=t.length,a=null,n="",i=e.getAttribute("id"),o=0;o<r;o++)a=t[o],n=HTMLDB.getHTMLDBParameter(a,"field"),void 0!==HTMLDB.activeFormFields[i]&&void 0!==HTMLDB.activeFormFields[i][n]&&HTMLDB.activeFormFields[i][n].length>0&&HTMLDB.registerFormElementEvent(a,function(){HTMLDB.doActiveFormFieldUpdate(a,n)})},initializeHTMLDBSelects:function(){var e,t,r=HTMLDB.q("select.htmldb-field"),a=r.length,n=[];for(e=0;e<a;e++){for(n=[],t=0;t<r[e].options.length;t++)n.push({text:r[e].options[t].text,value:r[e].options[t].value});void 0===r[e].HTMLDBInitials&&(r[e].HTMLDBInitials={}),r[e].HTMLDBInitials.initialOptions=n}},initializeHTMLDBToggles:function(){var e,t=HTMLDB.q(".htmldb-toggle"),r=t.length,a=null,n=null,i=[],o="",l=[],d=0,u="",T="",s="";HTMLDB.activeToggleFields=[];for(var L=0;L<r;L++){if(a=t[L],-1!=(n=HTMLDB.extractToggleParentElement(a)).className.indexOf("htmldb-form"))T='var success=false;var object=HTMLDB.convertFormToObject(HTMLDB.e("'+n.getAttribute("id")+'"));';else{if(u=HTMLDB.getHTMLDBParameter(n,"table"),!HTMLDB.e(u))throw new Error("HTMLDB section table "+u+" not found.");T='var success=false;var object=HTMLDB.get(HTMLDB.e("'+u+'"), HTMLDB.getActiveId(HTMLDB.e("'+u+'")));'}if(null==n)throw new Error("HTMLDB toggle (index: "+L+")  parent form/section  not found.");if(""!=(o=HTMLDB.getHTMLDBParameter(a,"filter"))){s=HTMLDB.generateFilterFunctionBlock(o,n),l=HTMLDB.extractFormToggleFields(o,n);try{a.toggleFunction=new Function(T+s+"return success;"),a.toggleEventFields=l}catch(e){throw new Error("HTMLDB toggle (index: "+L+")  toggle function could not be created.")}d=l.length;for(var c=0;c<d;c++)void 0===HTMLDB.activeToggleFields[l[c]]&&(HTMLDB.activeToggleFields[l[c]]=[]),HTMLDB.activeToggleFields[l[c]].push(a);i.push(n),void 0===n.toggleFields&&(n.toggleFields=[]),void 0===n.toggleEventFields&&(n.toggleEventFields=[]),n.toggleFields=n.toggleFields.concat(l)}}e=i.length;for(L=0;L<e;L++)-1!=(n=i[L]).className.indexOf("htmldb-form")&&HTMLDB.registerFormToggleEvents(n)},extractFormToggleFields:function(e,t){var r=String(e).split("/"),a=r.length,n=[];if(""==e)return[];for(var i=0;i<a;i+=4)property=HTMLDB.evaluateHTMLDBExpression(r[i]),""!=property&&n.push(property);return n},registerFormToggleEvents:function(e){var t=e.elements,r=t.length,a=null,n="";if(void 0!==e.toggleFields&&0!=e.toggleFields.length){void 0===e.toggleEventFields&&(e.toggleEventFields=[]);for(var i=0;i<r;i++)a=t[i],""!=(n=HTMLDB.getHTMLDBParameter(a,"field"))&&-1!=e.toggleFields.indexOf(n)&&-1==e.toggleEventFields.indexOf(n)&&(HTMLDB.registerFormElementEvent(a,function(e){HTMLDB.doActiveElementToggle(HTMLDB.getEventTarget(e))}),-1==e.toggleEventFields.indexOf(n)&&e.toggleEventFields.push(n))}},registerFormElementEvent:function(e,t){var r=e.tagName.toLowerCase(),a=e.type.toLowerCase(),n=HTMLDB.exploreHTMLDBForm(e);if("input"==r){if("checkbox"==a)e.addEventListener?(e.addEventListener("click",t,!0),e.addEventListener("change",t,!0)):e.attachEvent&&(e.attachEvent("onclick",t),e.attachEvent("onchange",t));else if("radio"==a)for(var i=n.elements,o=i.length,l=null,d="",u=0;u<o;u++)l=i[u],""!=(d=HTMLDB.getHTMLDBParameter(l,"field"))&&l.name==e.name&&(l.addEventListener?(l.addEventListener("click",t,!0),l.addEventListener("change",t,!0)):l.attachEvent&&(l.attachEvent("onclick",t),l.attachEvent("onchange",t)),-1==n.toggleEventFields.indexOf(d)&&n.toggleEventFields.push(d))}else"select"==r&&(e.addEventListener?e.addEventListener("change",t,!0):e.attachEvent&&e.attachEvent("onchange",t))},doParentElementToggle:function(e){if(!0!==e.toggling){e.toggling=!0;for(var t=e.querySelectorAll(".htmldb-toggle"),r=t.length,a=null,n=0;n<r;n++)(a=t[n]).toggleFunction&&(a.toggleFunction()?HTMLDB.assignToggleOnStyles(a):HTMLDB.assignToggleOffStyles(a));setTimeout(function(){e.toggling=!1},100)}},assignToggleOnStyles:function(e){if(e){var t=HTMLDB.getHTMLDBParameter(e,"data-htmldb-display-style"),r=HTMLDB.getHTMLDBParameter(e,"data-htmldb-toggle-on-class"),a=HTMLDB.getHTMLDBParameter(e,"data-htmldb-toggle-off-class"),n=[],i=0;if(""!=a){i=(n=String(a).split(" ")).length;for(var o=0;o<i;o++)""!=n[o]&&e.classList.remove(n[o])}if(""!=r){i=(n=String(r).split(" ")).length;for(o=0;o<i;o++)""!=n[o]&&e.classList.add(n[o])}""!=t&&(e.style.display=t),""==r&&""==t&&(e.style.display="block")}},assignToggleOffStyles:function(e){if(e){HTMLDB.getHTMLDBParameter(e,"data-htmldb-display-style");var t=HTMLDB.getHTMLDBParameter(e,"data-htmldb-toggle-on-class"),r=HTMLDB.getHTMLDBParameter(e,"data-htmldb-toggle-off-class"),a=[],n=0;if(""!=t){n=(a=String(t).split(" ")).length;for(var i=0;i<n;i++)""!=a[i]&&e.classList.remove(a[i])}if(""!=r){n=(a=String(r).split(" ")).length;for(i=0;i<n;i++)""!=a[i]&&e.classList.add(a[i])}""==r&&(e.style.display="none")}},doActiveElementToggle:function(e){if(!0!==e.toggling){e.toggling=!0;var t=HTMLDB.getHTMLDBParameter(e,"field");if(""!=t&&void 0!==HTMLDB.activeToggleFields[t]){for(var r=HTMLDB.activeToggleFields[t],a=r.length,n=null,i=0;i<a;i++)(n=r[i]).toggleFunction&&(n.toggleFunction()?HTMLDB.assignToggleOnStyles(n):HTMLDB.assignToggleOffStyles(n));setTimeout(function(){e.toggling=!1},100)}}},extractToggleParentElement:function(e){for(var t=!1,r=e.parentNode;!t&&"html"!=r.tagName.toLowerCase();)-1!=r.className.indexOf("htmldb-section")?t=!0:-1!=r.className.indexOf("htmldb-form")&&(t=!0),t||(r=r.parentNode);return t?r:null},renderSectionElement:function(e){if(!e)return!1;var t=HTMLDB.exploreHTMLDBTable(e),r="",a="",n="";if(void 0!==e.HTMLDBInitials&&void 0!==e.HTMLDBInitials.attributes)for(var i=e.HTMLDBInitials.attributes.length,o=0;o<i;o++)r=e.HTMLDBInitials.attributes[o].name,a=e.HTMLDBInitials.attributes[o].value,n=HTMLDB.evaluateHTMLDBExpression(a,t),e.setAttribute(r,n);switch(String(e.tagName).toLowerCase()){case"a":HTMLDB.hasHTMLDBParameter(e,"href")&&e.setAttribute("href",HTMLDB.getHTMLDBParameter(e,"href"))}var l=e.children.length,d=null;for(o=0;o<l;o++)d=e.children[o],HTMLDB.renderSectionElement(d);0==l&&(void 0!==e.HTMLDBInitials&&void 0!==e.HTMLDBInitials.content?(""==(n=HTMLDB.evaluateHTMLDBExpression(e.HTMLDBInitials.content,t))&&(n=HTMLDB.getHTMLDBParameter(e,"default-content")),HTMLDB.setElementContent(e,n)):HTMLDB.hasHTMLDBParameter(e,"content")?(""==(n=HTMLDB.evaluateHTMLDBExpression(HTMLDB.getHTMLDBParameter(e,"content"),t))&&(n=HTMLDB.getHTMLDBParameter(e,"default-content")),HTMLDB.setElementContent(e,n)):HTMLDB.hasHTMLDBParameter(e,"htmldb-value")&&(""==(n=HTMLDB.getHTMLDBParameter(e,"htmldb-value"))&&(n=HTMLDB.getHTMLDBParameter(e,"reset-value")),HTMLDB.setInputValue(e,HTMLDB.evaluateHTMLDBExpression(HTMLDB.getHTMLDBParameter(e,"htmldb-value"),t))))},setElementContent:function(e,t){if(e)switch(String(e.tagName).toLowerCase()){case"img":e.src=t;break;default:e.innerHTML=t}},renderFormElement:function(e,t){var r=e.querySelectorAll("input.htmldb-field,select.htmldb-field,textarea.htmldb-field"),a=r.length,n=null,i="",o="",l=HTMLDB.exploreHTMLDBTable(e),d="",u=[],T=HTMLDB.getActiveId(l);void 0===t&&(t=HTMLDB.get(l,T));for(var s=0;s<a;s++)n=r[s],i=HTMLDB.getHTMLDBParameter(n,"field"),d="",""==(o=HTMLDB.getHTMLDBParameter(n,"htmldb-value"))||o=="{{"+i+"}}"?(o="{{"+i+"}}",d=void 0!==t[i]?t[i]:HTMLDB.getHTMLDBParameter(n,"reset-value")):d=HTMLDB.evaluateHTMLDBExpressionWithObject(o,t),void 0===n.HTMLDBInitials?n.HTMLDBInitials={renderValue:d}:n.HTMLDBInitials.renderValue=d,HTMLDB.setInputValue(n,d,!0),u[s]=d;e.HTMLDBFormToObjectCache=void 0;for(s=0;s<a;s++)(n=r[s]).dispatchEvent(new CustomEvent("htmldbsetvalue",{detail:{value:u[s]}})),HTMLDB.doActiveElementToggle(n)},renderPaginationElement:function(e){var t,r,a,n,i,o,l,d=HTMLDB.getHTMLDBParameter(e,"table"),u=HTMLDB.e(d),T=HTMLDB.getActiveId(u),s="";if(""==d)throw new Error("HTMLDB pagination table not specified.");if(!HTMLDB.e(d))throw new Error("HTMLDB pagination table "+d+" not found.");if(r=t=(s=HTMLDB.getHTMLDBParameter(e,"refresh-table")).split(","),refreshTable=null,""==s)throw new Error("HTMLDB pagination refresh table not specified.");for(var L=0;L<r;L++)if(refreshTable=HTMLDB.e(t[L]),!refreshTable)throw new Error("HTMLDB table "+t[L]+" referenced as pagination refresh table, but not found.");if(""==(a=HTMLDB.getHTMLDBParameter(e,"page-field")))throw new Error("HTMLDB pagination data-htmldb-page-field attribute not specified.");if(""==(n=HTMLDB.getHTMLDBParameter(e,"page-count-field")))throw new Error("HTMLDB pagination data-htmldb-page-count-field attribute not specified.");if(""==T)throw new Error("HTMLDB pagination table "+d+" is not active, or has no records.");var c=d+"_reader_td"+T+a;if(!HTMLDB.e(c))throw new Error("HTMLDB pagination page field "+d+"."+a+" not found.");if(i=d+"_reader_td"+T+n,!HTMLDB.e(i))throw new Error("HTMLDB pagination page count field "+d+"."+n+" not found.");if(o=parseInt(HTMLDB.e(c).innerHTML),isNaN(o))throw new Error("HTMLDB pagination page value "+d+"."+a+" is not valid.");if(l=parseInt(HTMLDB.e(i).innerHTML),isNaN(l))throw new Error("HTMLDB pagination page count value "+d+"."+n+" is not valid.");e.setAttribute("data-htmldb-page",o),e.setAttribute("data-htmldb-page-count",l),e.classList.remove("htmldb-loading"),HTMLDB.removePaginationElements(e),HTMLDB.createPaginationElements(e),e.dispatchEvent(new CustomEvent("htmldbrender",{detail:{}}))},removePaginationElements:function(e){for(var t=e.getElementsByClassName("htmldb-pagination-element");t.length>0;)e.removeChild(t[0])},createPaginationElements:function(e){for(var t=HTMLDB.getHTMLDBParameter(e,"page"),r=HTMLDB.getHTMLDBParameter(e,"page-count"),a=null,n=null,i=null,o=null,l=null,d=e.children,u=d.length,T=null,s=0;s<u;s++)if(-1!=(T=d[s]).className.indexOf("htmldb-pagination-template")&&(-1!=T.className.indexOf("htmldb-pagination-previous")&&(a=T),-1!=T.className.indexOf("htmldb-pagination-next")&&(n=T),-1!=T.className.indexOf("htmldb-pagination-default")&&(i=T),-1!=T.className.indexOf("htmldb-pagination-active")&&(o=T),-1!=T.className.indexOf("htmldb-pagination-hidden")&&(l=T),0==T.querySelectorAll(".htmldb-button-page").length))throw new Error("HTMLDB pagination templates must have page buttons specified with htmldb-button-page class.");if(null==a&&null==n&&null==i)throw new Error("HTMLDB pagination previous-next or default page template(s) not specified.");if(null!=a&&null==n&&null==i)throw new Error("HTMLDB pagination previous page template defined but next or default page template not specified.");if(null!=n&&null==a&&null==i)throw new Error("HTMLDB pagination next page template defined but previous or default page template not specified.");if(null==o)throw new Error("HTMLDB pagination active template not specified.");if(t=parseInt(t),r=parseInt(r),previousPage=t-1,!(r<=1)){if(previousPage<0&&(previousPage=0),nextPage=t+1,nextPage>=r&&(nextPage=r-1),null!=a&&HTMLDB.clonePaginationElement(a,previousPage+1),r<7)for(s=0;s<r;s++)s==t?HTMLDB.clonePaginationElement(o,s+1):HTMLDB.clonePaginationElement(i,s+1);else{var L=0,c=r-1,D=!0,M=!0;t<4?(D=!1,L=0,c=4):t>r-5?(M=!1,L=r-5,c=r-1):(L=t-1,c=t+1),D&&(HTMLDB.clonePaginationElement(i,1),null!=l&&HTMLDB.clonePaginationElement(l,0));for(s=L;s<=c;s++)s==t?HTMLDB.clonePaginationElement(o,s+1):HTMLDB.clonePaginationElement(i,s+1);M&&(null!=l&&HTMLDB.clonePaginationElement(l,0),HTMLDB.clonePaginationElement(i,r))}null!=n&&HTMLDB.clonePaginationElement(n,nextPage+1)}},clonePaginationElement:function(e,t){var r=e.cloneNode(!0);r.classList.remove("htmldb-pagination-template"),r.classList.add("htmldb-pagination-element"),e.parentNode.appendChild(r),HTMLDB.storeSectionElementTemplates(r),HTMLDB.renderElementWithObject(r,{page:t});for(var a=r.querySelectorAll(".htmldb-button-page"),n=a.length,i=null,o=0;o<n;o++)(i=a[o]).setAttribute("data-htmldb-page",t),i.addEventListener?i.addEventListener("click",HTMLDB.doPaginationButtonClick,!0):i.attachEvent&&i.attachEvent("onclick",HTMLDB.doPaginationButtonClick)},doPaginationButtonClick:function(e){var t=parseInt(HTMLDB.getEventTarget(e).getAttribute("data-htmldb-page"))-1;if(isNaN(t))throw new Error("HTMLDB pagination button has no valid data-htmldb-page attribute.");var r=HTMLDB.exploreHTMLDBPagination(HTMLDB.getEventTarget(e)),a=HTMLDB.exploreHTMLDBTable(HTMLDB.getEventTarget(e));if(!a)throw new Error("HTMLDB pagination table not found.");if(-1!=(" "+r.className+" ").indexOf(" htmldb-loading "))return!1;r.classList.add("htmldb-loading");var n=HTMLDB.getActiveId(a),i=HTMLDB.get(a,n);if(void 0===i.page)throw new Error("HTMLDB pagination table "+a.getAttribute("id")+" has no page column.");var o=HTMLDB.getHTMLDBParameter(r,"table-defaults");(i=HTMLDB.parseObjectDefaults(i,o)).page=t,HTMLDB.e(a.getAttribute("id")+"_reader_td"+n+"page").innerHTML=t,HTMLDB.insert(a,i),HTMLDB.updateReadQueueCallbacks(a,function(){HTMLDB.updateReadQueueWithParameter(r,"refresh-table")}),r.dispatchEvent(new CustomEvent("htmldbpageclick",{detail:{page:t}}))},parseObjectDefaults:function(e,t){if(""==t)return e;"'"==(t=HTMLDB.evaluateHTMLDBExpression(t))[0]&&(t=t.slice(1,-1));try{defaultsObject=JSON.parse(String(t).trim())}catch(e){throw new Error("HTMLDB defaults attribute value has no valid JSON format")}for(var r in defaultsObject)e[r]=defaultsObject[r];return e},renderElementWithObject:function(e,t){if(!e)return!1;if(!t)return!1;if(void 0!==e.HTMLDBInitials&&void 0!==e.HTMLDBInitials.attributes)for(var r=e.HTMLDBInitials.attributes.length,a="",n="",i="",o=0;o<r;o++)a=e.HTMLDBInitials.attributes[o].name,n=e.HTMLDBInitials.attributes[o].value,i=HTMLDB.evaluateHTMLDBExpressionWithObject(n,t),e.setAttribute(a,i);var l=e.children.length,d=null;for(o=0;o<l;o++)d=e.children[o],HTMLDB.renderElementWithObject(d,t);0==l&&(void 0!==e.HTMLDBInitials&&void 0!==e.HTMLDBInitials.content?(i=HTMLDB.evaluateHTMLDBExpressionWithObject(e.HTMLDBInitials.content,t),e.innerHTML=i):HTMLDB.hasHTMLDBParameter(e,"content")&&(e.innerHTML=HTMLDB.getHTMLDBParameter(e,"content")))},doActiveFormFieldUpdate:function(e,t){var r,a;if(e&&""!=t){var n=HTMLDB.exploreHTMLDBForm(e).getAttribute("id"),i=null;if(void 0!==HTMLDB.activeFormFields[n]&&void 0!==HTMLDB.activeFormFields[n][t]&&0!=(r=HTMLDB.activeFormFields[n][t]).length){a=r.length;for(var o=0;o<a;o++){if(!(i=HTMLDB.e(r[o])))throw new Error("HTMLDB table "+r[o]+" referenced by "+t+" in "+n+" but not found.");HTMLDB.updateReadQueue(i)}}}},renderSelectElement:function(e){var t=HTMLDB.getHTMLDBParameter(e,"option-table");if(""!=t){if(!HTMLDB.e(t))throw new Error("HTMLDB table "+t+" not found. Referenced by data-htmldb-option-table attribute of select element "+e.getAttribute("id"));var r,a=HTMLDB.e(t),n=a.getAttribute("data-htmldb-active-id"),i=HTMLDB.e(t+"_reader_tbody").children,o=i.length,l=null,d=null,u=0,T="",s="",L=!1,c="",D=!1,M=null,B="",H="",g=HTMLDB.getHTMLDBParameter(e,"add-option-caption"),m=HTMLDB.getHTMLDBParameter(e,"add-option-form"),b=[],f=null;if(void 0!==e.HTMLDBInitials&&void 0!==e.HTMLDBInitials.initialOptions&&(b=e.HTMLDBInitials.initialOptions),""!=g&&""==m)throw new Error("HTMLDB select element "+e.getAttribute("id")+" data-htmldb-add-option-caption attribute value is specified, but data-htmldb-add-option-form attribute value is not specified.");e.innerHTML="",""!=g&&(e.options[0]=new Option(" "+g,g),e.options[0].HTMLDBInitials={},e.options[0].HTMLDBInitials.id=0,e.addEventListener?e.addEventListener("change",HTMLDB.doSelectChange,!0):e.attachEvent&&e.attachEvent("onchange",HTMLDB.doSelectChange)),r=b.length;for(var v=0,h=0;h<r;h++)f=b[h],v=e.options.length,e.options[v]=new Option(f.text,f.value),e.options[v].HTMLDBInitials={},e.options[v].HTMLDBInitials.id=f.value;for(B="",h=0;h<o;h++)l=i[h],u=HTMLDB.getHTMLDBParameter(l,"data-row-id"),a.setAttribute("data-htmldb-active-id",u),d=HTMLDB.convertRowToObject(a,l),T=HTMLDB.evaluateHTMLDBExpression(HTMLDB.getHTMLDBParameter(e,"option-title"),a),s=HTMLDB.evaluateHTMLDBExpression(HTMLDB.getHTMLDBParameter(e,"option-value"),a),v=e.options.length,e.options[v]=new Option(T,s),e.options[v].HTMLDBInitials={},e.options[v].HTMLDBInitials.id=d.id,""!=B&&(B+=","),B+=s;void 0!==e.HTMLDBInitials&&(void 0!==e.HTMLDBInitials.renderValue&&(L=!0,c=e.HTMLDBInitials.renderValue),void 0!==e.HTMLDBInitials.selectNewOption&&(D=e.HTMLDBInitials.selectNewOption),void 0!==e.HTMLDBInitials.optionValueCSV&&(H=e.HTMLDBInitials.optionValueCSV)),e.HTMLDBInitials={initialOptions:b,content:e.innerHTML,optionValueCSV:B,previousOptionValueCSV:H},a.setAttribute("data-htmldb-active-id",n),e.dispatchEvent(new CustomEvent("htmldbsetoptions",{detail:{}})),D?null!=(M=HTMLDB.getSelectNewOptionValue(e))&&(HTMLDB.setInputValue(e,M),e.dispatchEvent(new CustomEvent("htmldbsetvalue",{detail:{value:M}}))):L&&(HTMLDB.setInputValue(e,c),e.dispatchEvent(new CustomEvent("htmldbsetvalue",{detail:{value:c}})))}},getSelectNewOptionValue:function(e){var t="",r="";void 0!==e.HTMLDBInitials&&(void 0!==e.HTMLDBInitials.previousOptionValueCSV&&(r=e.HTMLDBInitials.previousOptionValueCSV),void 0!==e.HTMLDBInitials.optionValueCSV&&(t=e.HTMLDBInitials.optionValueCSV));for(var a=r.split(","),n=t.split(","),i=n.length,o=0;o<i;o++)if(-1==a.indexOf(n[o]))return n[o];return null},initializeHTMLDBRefreshButtons:function(e){null==e&&(e=document.body);for(var t=e.querySelectorAll(".htmldb-button-refresh"),r=t.length,a=null,n=0;n<r;n++)(a=t[n]).addEventListener?a.addEventListener("click",HTMLDB.doRefreshButtonClick,!0):a.attachEvent&&a.attachEvent("onclick",HTMLDB.doRefreshButtonClick)},initializeHTMLDBAddButtons:function(e){null==e&&(e=document.body);for(var t=e.querySelectorAll(".htmldb-button-add"),r=t.length,a=null,n=0;n<r;n++)(a=t[n]).addEventListener?a.addEventListener("click",HTMLDB.doAddButtonClick,!0):a.attachEvent&&a.attachEvent("onclick",HTMLDB.doAddButtonClick)},initializeHTMLDBSaveButtons:function(e){null==e&&(e=document.body);for(var t=e.querySelectorAll(".htmldb-button-save"),r=t.length,a=null,n=0;n<r;n++)(a=t[n]).addEventListener?a.addEventListener("click",HTMLDB.doSaveButtonClick,!0):a.attachEvent&&a.attachEvent("onclick",HTMLDB.doSaveButtonClick)},initializeHTMLDBSortButtons:function(e){null==e&&(e=document.body);for(var t=e.querySelectorAll(".htmldb-button-sort"),r=t.length,a=null,n=0;n<r;n++)(a=t[n]).addEventListener?a.addEventListener("click",HTMLDB.doSortButtonClick,!0):a.attachEvent&&a.attachEvent("onclick",HTMLDB.doSortButtonClick)},initializeHTMLDBEditButtons:function(e,t){null==e&&(e=document.body);for(var r=e.querySelectorAll(".htmldb-button-edit"),a=r.length,n=null,i=0;i<a;i++)n=r[i],t&&HTMLDB.getHTMLDBParameter(n,"table")!=t.getAttribute("id")||(n.addEventListener?n.addEventListener("click",HTMLDB.doEditButtonClick,!0):n.attachEvent&&n.attachEvent("onclick",HTMLDB.doEditButtonClick))},initializeHTMLDBSaveInputs:function(e){null==e&&(e=document.body);for(var t=e.querySelectorAll(".htmldb-input-save"),r=t.length,a=null,n="",i="",o=0;o<r;o++)switch(a=t[o],n=String(a.tagName).toLowerCase(),i=String(a.getAttribute("type")).toLowerCase(),n){case"input":"checkbox"==i||"radio"==i?a.addEventListener?a.addEventListener("click",HTMLDB.doSaveInputEvent,!0):a.attachEvent&&a.attachEvent("onclick",HTMLDB.doSaveInputEvent):a.addEventListener?(a.addEventListener("input",HTMLDB.doSaveInputEvent,!0),a.addEventListener("keyup",HTMLDB.doSaveInputKeyUp,!0)):a.attachEvent&&(a.attachEvent("oninput",HTMLDB.doSaveInputEvent),a.attachEvent("onkeyup",HTMLDB.doSaveInputKeyUp));break;case"textarea":a.addEventListener?a.addEventListener("input",HTMLDB.doSaveInputEvent,!0):a.attachEvent&&a.attachEvent("oninput",HTMLDB.doSaveInputEvent);break;case"select":a.addEventListener?a.addEventListener("change",HTMLDB.doSaveInputEvent,!0):a.attachEvent&&a.attachEvent("onchange",HTMLDB.doSaveInputEvent);break;case"button":a.addEventListener?a.addEventListener("click",HTMLDB.doSaveInputEvent,!0):a.attachEvent&&a.attachEvent("onclick",HTMLDB.doSaveInputEvent)}},doSaveInputEvent:function(e){var t=HTMLDB.getEventTarget(e),r=parseInt(HTMLDB.getHTMLDBParameter(t,"save-delay"));isNaN(r)&&(r=500),r>0?(clearTimeout(t.tmSaveDelay),t.tmSaveDelay=setTimeout(function(){clearTimeout(t.tmSaveDelay),HTMLDB.doSaveInputEventNow(e)},r)):HTMLDB.doSaveInputEventNow(e)},doSaveInputKeyUp:function(e){HTMLDB.getEventTarget(e);13==e.keyCode&&HTMLDB.doSaveInputEventNow(e)},doSaveInputEventNow:function(e){var t=HTMLDB.getEventTarget(e);t=HTMLDB.exploreHTMLDBElement(t,"htmldb-input-save"),clearTimeout(t.tmSaveDelay),t.dispatchEvent(new CustomEvent("htmldbbeforesave",{detail:{}}));var r=HTMLDB.getInputValue(t),a=HTMLDB.getHTMLDBParameter(t,"table"),n=HTMLDB.e(a),i=HTMLDB.getHTMLDBParameter(t,"input-field");if(!n)throw new Error("HTMLDB input table "+a+" not found.");if(-1!=(" "+t.className+" ").indexOf(" htmldb-loading "))return!1;t.classList.add("htmldb-loading"),HTMLDB.addParentLoadingClass(t);var o=HTMLDB.getHTMLDBParameter(t,"edit-id");""==String(o).trim()&&(o=HTMLDB.getActiveId(n));var l=HTMLDB.get(n,o);if(void 0===l[i])throw new Error("HTMLDB input table "+n.getAttribute("id")+" has no "+i+" column.");var d=HTMLDB.getHTMLDBParameter(t,"table-defaults");(l=HTMLDB.parseObjectDefaults(l,d))[i]=r,HTMLDB.e(n.getAttribute("id")+"_reader_td"+o+i).innerHTML=r,HTMLDB.updateReadQueueCallbacks(n,function(){t.classList.remove("htmldb-loading"),HTMLDB.removeParentLoadingClass(t),HTMLDB.updateReadQueueWithParameter(t,"refresh-table")}),HTMLDB.insert(n,l),t.dispatchEvent(new CustomEvent("htmldbsave",{detail:{}}))},doSortButtonClick:function(e){var t=HTMLDB.getEventTarget(e),r=HTMLDB.getHTMLDBParameter(t,"table"),a=HTMLDB.e(r),n=HTMLDB.getHTMLDBParameter(t,"sort-field"),i=HTMLDB.getHTMLDBParameter(t,"sort-value"),o=HTMLDB.getHTMLDBParameter(t,"direction-field"),l=!1;if(!a)throw new Error("HTMLDB button table "+r+" not found.");var d=" "+t.className+" ";if(-1!=d.indexOf(" htmldb-loading "))return!1;l=-1!=d.indexOf(" htmldb-sorting-asc ");var u=HTMLDB.getActiveId(a),T=HTMLDB.get(a,u);if(void 0===T[n])throw new Error("HTMLDB button table "+a.getAttribute("id")+" has no "+n+" column.");if(void 0===T[o])throw new Error("HTMLDB button table "+a.getAttribute("id")+" has no "+o+" column.");t.classList.add("htmldb-loading"),HTMLDB.addParentLoadingClass(t),l?(t.classList.remove("htmldb-sorting-asc"),t.classList.add("htmldb-sorting-desc"),t.setAttribute("data-htmldb-sorting-asc",0)):(t.classList.add("htmldb-sorting-asc"),t.classList.remove("htmldb-sorting-desc"),t.setAttribute("data-htmldb-sorting-asc",1));var s=HTMLDB.getHTMLDBParameter(t,"table-defaults");(T=HTMLDB.parseObjectDefaults(T,s))[n]=i,T[o]=l?2:1,HTMLDB.e(a.getAttribute("id")+"_reader_td"+u+n).innerHTML=i,HTMLDB.e(a.getAttribute("id")+"_reader_td"+u+o).innerHTML=T[o],HTMLDB.updateReadQueueCallbacks(a,function(){t.classList.remove("htmldb-loading"),HTMLDB.removeParentLoadingClass(t),HTMLDB.updateReadQueueWithParameter(t,"refresh-table")}),HTMLDB.insert(a,T),t.dispatchEvent(new CustomEvent("htmldbsort",{detail:{}}))},updateReadQueueWithParameter:function(e,t){for(var r=HTMLDB.getHTMLDBParameter(e,t).split(","),a=r.length,n="",i=null,o=0;o<a;o++)if(n=r[o],""!=String(n).trim()){if(!(i=HTMLDB.e(n)))throw new Error("HTMLDB table "+n+" referenced in "+t+" attribute but not found.");HTMLDB.updateReadQueue(i)}return!0},initializeReadQueue:function(){var e=HTMLDB.q(".htmldb-table"),t=e.length,r=null,a=[],n=[],i=0,o=0;HTMLDB.readQueue=null;for(var l=0;l<t;l++)r=e[l],o=parseInt(HTMLDB.getHTMLDBParameter(r,"priority")),-1==a.indexOf(o)&&a.push(o);a.sort();for(l=0;l<t;l++)r=e[l],""==HTMLDB.getHTMLDBParameter(r,"form")&&(o=parseInt(HTMLDB.getHTMLDBParameter(r,"priority")),void 0===n[i=a.indexOf(o)]&&(n[i]=[]),n[i].push(r.getAttribute("id")));HTMLDB.readQueue=n,HTMLDB.processReadQueue()},readChildTable:function(e,t){if(!e)throw new Error("HTMLDB table "+e.getAttribute("id")+" will be readed, but not found.");var r=e.getAttribute("id");if(parseInt(e.getAttribute("data-htmldb-loading"))>0)throw new Error("HTMLDB table "+r+" is loading right now.");var a=HTMLDB.getHTMLDBParameter(e,"table");if(""==a)throw new Error("HTMLDB child table "+r+" has no table attribute.");var n=HTMLDB.e(a);if(!n)throw new Error("HTMLDB table "+a+" is referenced by "+r+", but not found.");HTMLDB.e(r+"_reader_thead").innerHTML=HTMLDB.e(a+"_reader_thead").innerHTML,HTMLDB.e(r+"_writer_thead").innerHTML=HTMLDB.e(a+"_reader_thead").innerHTML;var i=HTMLDB.e(a+"_reader_tbody").children,o=i.length,l=null,d=null,u=0,T="",s="";HTMLDB.updateTableFilterFunction(e);for(var L=0;L<o;L++)l=i[L],u=HTMLDB.getHTMLDBParameter(l,"data-row-id"),d=HTMLDB.convertRowToObject(n,l),e.filterFunction&&!e.filterFunction(d)||(T+='<tr class="refreshed" data-row-id="'+u+'" id="'+r+"_reader_tr"+u+'">',T+=HTMLDB.generateTDHTML(e,"_reader",d,u),T+="</tr>",""==s&&(s=u));return HTMLDB.e(r+"_reader_tbody").innerHTML=T,e.setAttribute("data-htmldb-active-id",s),HTMLDB.removeFromReadingQueue(e),HTMLDB.render(e),!0},convertRowToObject:function(e,t){for(var r={},a=t.children,n=a.length,i=null,o=t.getAttribute("data-row-id"),l=0;l<n;l++)r[(i=a[l]).getAttribute("id").replace(e.getAttribute("id")+"_reader_td"+o,"")]=i.innerHTML;return r},convertListRowToObject:function(e,t){for(var r={},a=t.length,n=0;n<a;n++)r[t[n]]=e[n];return r},getMaxPriority:function(e){for(var t=e.length,r=null,a=0,n=0,i=0;i<t;i++){if(!HTMLDB.e(e[i]))throw new Error("HTMLDB table "+e[i]+" is referenced, but not found.");r=HTMLDB.e(e[i]),(n=parseInt(HTMLDB.getHTMLDBParameter(r,"priority")))>a&&(a=n)}return a},processReadQueue:function(){var e=document.body.HTMLDBReadQueueProcessTimer;if(clearTimeout(e),void 0!==HTMLDB.readQueue&&0!=HTMLDB.readQueue.length&&(HTMLDB.isIdle()||(e=setTimeout(function(){HTMLDB.processReadQueue()},1e3),document.body.HTMLDBReadQueueProcessTimer=e),!HTMLDB.pausing)){for(HTMLDB.readingQueue=void 0;void 0===HTMLDB.readingQueue&&HTMLDB.readQueue.length>0;)HTMLDB.readingQueue=HTMLDB.readQueue.shift();var t="",r=null,a=0,n=0,i=[];if(HTMLDB.readingQueue){n=(i=HTMLDB.readingQueue.slice()).length;for(var o=0;o<n;o++)t=i[o],r=HTMLDB.e(t),HTMLDB.isInReadQueue(r)||(HTMLDB.isHTMLDBParameter(r,"local")?(HTMLDB.readLocal(r),a++):(HTMLDB.read(r),a++))}0==a&&HTMLDB.processReadQueue()}},removeFromReadingQueue:function(e){var t=HTMLDB.readingQueue.indexOf(e.getAttribute("id"));t>-1&&HTMLDB.readingQueue.splice(t,1)},extractParentTables:function(){for(var e=HTMLDB.q(".htmldb-table"),t=e.length,r=null,a=[],n="",i="",o=0;o<t;o++)a[(r=e[o]).getAttribute("id")]=[],(n=HTMLDB.getHTMLDBParameter(r,"table"))&&(a[r.getAttribute("id")]=a[r.getAttribute("id")].concat(Array(n))),(i=HTMLDB.extractHTMLDBExpressionTables(HTMLDB.getHTMLDBParameter(r,"read-url"))).length>0&&(a[r.getAttribute("id")]=a[r.getAttribute("id")].concat(i)),(i=HTMLDB.extractHTMLDBExpressionTables(HTMLDB.getHTMLDBParameter(r,"write-url"))).length>0&&(a[r.getAttribute("id")]=a[r.getAttribute("id")].concat(i)),(i=HTMLDB.extractHTMLDBExpressionTables(HTMLDB.getHTMLDBParameter(r,"validate-url"))).length>0&&(a[r.getAttribute("id")]=a[r.getAttribute("id")].concat(i)),(i=HTMLDB.extractHTMLDBExpressionTables(HTMLDB.getHTMLDBParameter(r,"filter"))).length>0&&(a[r.getAttribute("id")]=a[r.getAttribute("id")].concat(i));return a},extractChildTables:function(){var e=HTMLDB.extractParentTables(),t=[],r=0,a=0,n="";for(n in e)for(r=e[n].length,a=0;a<r;a++)void 0===t[e[n][a]]&&(t[e[n][a]]=[]),t[e[n][a]].push(n);return t},extractHTMLDBExpressionTables:function(e){var t,r=String(e).split("{{"),a=null,n="",i="",o=0;if(r.length<=1)return[];t=r.length,tables=[];for(var l=1;l<t;l++){for(n=r[l],o=1;"}"!=n[o-1]&&"}"!=n[o];)o++;"$"!=(i=(a=String(n).substr(0,o).split(".")).length>1?a[0]:"")[0]&&(":"!=i[0]&&""!=i&&tables.push(i))}return tables},getHTMLDBParameter:function(e,t){return e.getAttribute("data-htmldb-"+t)?e.getAttribute("data-htmldb-"+t):e.getAttribute("data-"+t)?e.getAttribute("data-"+t):e.getAttribute("htmldb-"+t)?e.getAttribute("htmldb-"+t):e.getAttribute(t)?e.getAttribute(t):""},isHTMLDBParameter:function(e,t){var r=HTMLDB.getHTMLDBParameter(e,t);return"true"==r||"1"==r},hasHTMLDBParameter:function(e,t){return!!e.getAttribute("data-htmldb-"+t)||(!!e.getAttribute("data-"+t)||(!!e.getAttribute("htmldb-"+t)||!!e.getAttribute(t)))},getURLParameter:function(e){if(isNaN(e))return"";var t=window.location.href,r=(t=t.replace(window.location.origin,"")).split("/");return e<0&&(e=r.length+e),void 0!==r[e]?r[e]:""},validateHTMLDBTableDefinition:function(e){var t=["_reader_table","_writer_table","_reader_thead","_writer_thead","_reader_tbody","_writer_tbody","_iframe_container","_form_container"],r=t.length;if(""==e.getAttribute("id"))throw new Error("All HTMLDB table element must have a unique id attribute.");for(var a=0;a<r;a++)if(HTMLDB.e(e.getAttribute("id")+t[a]))throw new Error(e.getAttribute("id")+t[a]+" has been used.");var n=HTMLDB.getHTMLDBParameter(e,"form");if(""!=n&&!HTMLDB.e(n))throw new Error("HTMLDB table "+e.getAttribute("id")+" referencing unknown form "+n);return!0},validateHTMLDBTemplateDefinition:function(e){var t=HTMLDB.getHTMLDBParameter(e,"table");HTMLDB.getHTMLDBParameter(e,"template-target");if(""==t||!HTMLDB.e(t))throw new Error(t+" HTMLDB table not found.");return!0},validateHTMLDBPaginationDefinition:function(e){var t=HTMLDB.getHTMLDBParameter(e,"table");if(""==t||!HTMLDB.e(t))throw new Error(t+" HTMLDB table referenced in htmldb-pagination element, but not found.");return!0},createHelperElements:function(e){var t,r,a="",n=e.getAttribute("id");a='<table id="'+n+'_reader_table"><thead id="'+n+'_reader_thead"></thead><tbody id="'+n+'_reader_tbody"></tbody></table>',a+='<table id="'+n+'_writer_table"><thead id="'+n+'_writer_thead"></thead><tbody id="'+n+'_writer_tbody"></tbody></table>',t='<div id="'+n+'_iframe_container"></div>',r='<div id="'+n+'_form_container"></div>',e.innerHTML=a+t+r},isLetter:function(e){return void 0!==e&&(1===e.length&&e.match(/[a-z_]/i))},isNumeric:function(e){return void 0!==e&&(1===e.length&&e.match(/[0-9]/))},generateTemplateRenderFunctionString:function(e,t,r){HTMLDB.e(t);var a,n=e.innerHTML,i=String(n).split("{{"),o=null,l="",d="",u="",T="",s="",L=0,c="";if(i.length<=1)return"";functionHeader='if(tableElement.getAttribute("id")!="'+t+"\")return;var generatedCode='';var rowCount=rows.length;var rowId=0;var object=null;var generatedIdList=[];var generatedId='';var generatedIdListIndex=0;var generatedIdListCount=0;var generatedCodeList=[];var success=false;for(var currentRow=0;currentRow<rowCount;currentRow++){rowId=rows[currentRow].getAttribute(\"data-row-id\");object=HTMLDB.get(tableElement, rowId);",""!=HTMLDB.getHTMLDBParameter(e,"filter")&&(functionHeader+="success=false;",functionHeader+=HTMLDB.generateFilterFunctionBlock(HTMLDB.getHTMLDBParameter(e,"filter"),e),functionHeader+="if(!success){continue;}"),d="generatedCode=''",(a=i.length)>1&&(s=l=i[0],s=String(s).replace(/(?:\r\n|\r|\n)/g,""),d+="+'"+HTMLDB.escapeSingleQuote(s)+"'");for(var D=1;D<a;D++){for(l=i[D],L=1;"}"!=l[L-1]&&"}"!=l[L]&&L<=l.length;)L++;if((o=String(l).substr(0,L).split(".")).length>1?(u=o[0],T=o[1]):(u="",T=o[0]),u==t&&(u=""),""!=u)d+='+HTMLDB.evaluateHTMLDBExpression("{{'+u+"."+T+'}}")';else switch(T){case"__is_first__":d+="+((currentRow==0)?'1':'0')";break;case"__is_not_first__":d+="+((currentRow!=0)?'1':'0')";break;case"__is_last__":d+="+((currentRow==(rowCount-1))?'1':'0')";break;case"__is_not_last__":d+="+((currentRow!=(rowCount-1))?'1':'0')";break;case"__is_even__":d+="+(HTMLDB.isEven(currentRow)?'1':'0')";break;case"__is_odd__":d+="+(HTMLDB.isEven(currentRow)?'0':'1')";break;case"__index__":d+="+(String(currentRow))";break;case"__count__":d+="+(String(rowCount))";break;default:d+='+object["'+T+'"]',-1==c.indexOf(","+t+"."+T+",")&&(functionHeader+='if(undefined===object["'+T+'"]){throw(new Error("An unknown field '+t+"."+T+' is used in template."));return;}',c+=","+t+"."+T+",")}s=String(l).substr(L+2),s=String(s).replace(/(?:\r\n|\r|\n)/g,""),d+="+'"+HTMLDB.escapeSingleQuote(s)+"'"}return d+=';generatedId=HTMLDB.evaluateHTMLDBExpression(HTMLDB.evaluateHTMLDBExpressionWithObject("'+r+'",object));generatedIdListIndex=generatedIdList.indexOf(generatedId);if(-1==generatedIdListIndex){generatedIdListIndex=generatedIdList.length;generatedIdList[generatedIdListIndex]=generatedId;generatedCodeList[generatedIdListIndex]=\'\';}generatedCodeList[generatedIdListIndex]+=generatedCode;}generatedIdListCount=generatedIdList.length;for(var i=0;i<generatedIdListCount;i++){if(!HTMLDB.e(generatedIdList[i])){throw(new Error("An element with the id="+generatedIdList[i]+" is referenced in template, but not found."));return;}if(-1==tableElement.HTMLDBTemplateTargets.indexOf(generatedIdList[i])){tableElement.HTMLDBTemplateTargets.push(generatedIdList[i]);}HTMLDB.e(generatedIdList[i]).innerHTML=generatedCodeList[i];}',functionHeader+d},generateTableFilterFunctionString:function(e){var t=HTMLDB.getHTMLDBParameter(e,"filter"),r="";return r="success=false;",r+=""!=t?HTMLDB.generateFilterFunctionBlock(t,e):"success=true;",r+="return success;"},generateFilterFunctionBlock:function(e,t){var r,a=-1!=t.className.indexOf("htmldb-form"),n=String(e).split("/"),i=n.length,o="",l=0,d="",u="",T="",s="||",L="HTMLDB"+(a?" form ":" table ")+t.getAttribute("id")+" has invalid filter attribute.";if(""==e)return o;for(r=HTMLDB.getHTMLDBParameter(t,"form");l<i;){if(d=HTMLDB.evaluateHTMLDBExpression(n[l],HTMLDB.e(r)),o+="success=(success"+s,++l>=i)throw new Error(L);if(u=String(n[l]).toLowerCase(),++l>=i)throw new Error(L);switch(""==(T=HTMLDB.evaluateHTMLDBExpression(n[l],HTMLDB.e(r)))?T=0:T.length>=2&&('"'===T.charAt(0)&&'"'===T.charAt(T.length-1)||"'"===T.charAt(0)&&"'"===T.charAt(T.length-1))&&(T=String(T).slice(1,-1)),u){case"is":case"eq":o+='(object["'+d+"\"]=='"+HTMLDB.escapeSingleQuote(T)+"')";break;case"isnot":case"neq":o+='(object["'+d+"\"]!='"+HTMLDB.escapeSingleQuote(T)+"')";break;case"gt":o+='(object["'+d+"\"]>'"+HTMLDB.escapeSingleQuote(T)+"')";break;case"gte":o+='(object["'+d+"\"]>='"+HTMLDB.escapeSingleQuote(T)+"')";break;case"lt":o+='(object["'+d+"\"]<'"+HTMLDB.escapeSingleQuote(T)+"')";break;case"lte":o+='(object["'+d+"\"]<='"+HTMLDB.escapeSingleQuote(T)+"')";break;case"in":o+="(-1!=String(',"+HTMLDB.escapeSingleQuote(T)+',\').indexOf(","+object["'+d+'"]+","))';break;case"notin":o+="(-1==String(',"+HTMLDB.escapeSingleQuote(T)+',\').indexOf(","+object["'+d+'"]+","))';break;default:throw new Error("HTMLDB"+(a?" form ":" table ")+t.getAttribute("id")+" has invalid filter operator:"+u)}if(o+=");",++l<i){if(l+3>=i)throw new Error(L);s="or"==(s=String(n[l]).toLowerCase())?"||":"&&"}l++}return o},isEven:function(e){return e=parseInt(e),isNaN(e)&&(e=0),e%2==0},encodeHTMLEntities:function(e){e=String(e);var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})},decodeHTMLEntities:function(e){var t=document.createElement("div");return e&&"string"==typeof e&&(e=(e=e.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,"")).replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,""),t.innerHTML=e,e=t.textContent,t.textContent=""),e},createNewIframeAndForm:function(e,t){var r=e.getAttribute("id"),a=HTMLDB.e(r+"_iframe_container"),n=HTMLDB.e(r+"_form_container"),i=null,o=null;(i=document.createElement("iframe")).src="",i.style.display="none",i.id=r+"_iframe_"+t,i.name=r+"_iframe_"+t,i.setAttribute("data-htmldb-id",r),a.appendChild(i),(o=document.createElement("form")).src="",o.style.display="none",o.id=r+"_form_"+t,o.name=r+"_form_"+t,o.method="post",o.target=r+"_iframe_"+t,o.setAttribute("data-htmldb-id",r),n.appendChild(o)},removeIframeAndForm:function(e,t){var r=e.getAttribute("id"),a=HTMLDB.e(r+"_iframe_container"),n=HTMLDB.e(r+"_form_container"),i=HTMLDB.e(r+"_iframe_"+t),o=HTMLDB.e(r+"_form_"+t);i.className="deleted",o.className="deleted",clearTimeout(e.HTMLDBRemoveIframeFormTimer),e.HTMLDBRemoveIframeFormTimer=setTimeout(function(){clearTimeout(e.HTMLDBRemoveIframeFormTimer);for(var t=a.getElementsByClassName("deleted");t.length>0;)a.removeChild(t[0]);for(var r=n.getElementsByClassName("deleted");r.length>0;)n.removeChild(r[0])},1e4)},generateTDHTML:function(e,t,r,a){var n="";for(var i in r)r.hasOwnProperty(i)&&(n+='<td id="'+e.getAttribute("id")+t+"_td"+a+i+'">'+r[i]+"</td>");return n},generateFormHTML:function(e,t,r){var a,n=HTMLDB.e(e.getAttribute("id")+"_form_"+t),i="";i=-1!=r.className.indexOf("deleted")?"deleted":-1!=r.className.indexOf("updated")?"updated":"inserted";for(var o='<input class="htmldb_action" type="hidden" name="htmldb_action'+(a=n.getElementsByClassName("htmldb_action").length)+'" value="'+i+'" />',l=HTMLDB.getColumnNames(e,!1),d=l.length,u=r.getAttribute("data-row-id"),T=e.getAttribute("id")+"_writer_td"+u,s=r.children.length,L={},c="",D=0;D<s;D++)L[r.children[D].getAttribute("id")]=r.children[D].innerHTML;for(D=0;D<d;D++)L.hasOwnProperty(T+l[D])&&(c=L[T+l[D]],o+='<input class="htmldb_row" type="hidden" name="htmldb_row'+a+"_"+l[D]+"\" value='"+HTMLDB.escapeSingleQuote(c)+"' />");n.innerHTML+=o},generateGUID:function(e){var t=new Date;return e||(e=""),e+(String(t.getUTCFullYear())+String(t.getUTCMonth()+1)+String(t.getUTCDate())+String(t.getHours())+String(t.getMinutes())+String(t.getSeconds()))+"xxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})+"xxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},generateDateTimeGUID:function(e){var t=new Date;return e||(e=""),e+String(t.getTime())+String(Math.floor(100+900*Math.random()))},evaluateHTMLDBExpression:function(e,t){for(var r=String(e).length,a="",n="",i=0,o=!1,l="",d=[],u="",T="",s="";i<r;)a=e[i],"{"==n&&"{"==a?(o=!0,u=String(u).substr(0,String(u).length-1)):"}"==n&&"}"==a?(o=!1,l=String(l).substr(0,String(l).length-1),(d=String(l).split(".")).length>1?(T=d[0],s=d[1]):(T="",s=d[0]),null!=t&&""==T&&(T=t.getAttribute("id")),"$"==T[0]?u+=HTMLDB.evaluateHTMLDBGlobalObject(T,s):":"==l[0]?u+=HTMLDB.evaluateHTMLDBJSCode(l):u+=""!=T?HTMLDB.getTableFieldActiveValue(HTMLDB.e(T),s):"{{"+l+"}}",l=""):o?l+=a:u+=a,i++,n=a;return l.length>0&&(u+=l),u},evaluateHTMLDBJSCode:function(e){var t="return "+(e=String(e).substring(1))+";";try{return new Function(t)()}catch(t){throw new Error(e+" could not be evaluated.")}},evaluateHTMLDBGlobalObject:function(e,t){switch(e=e.toLowerCase()){case"$url":return HTMLDB.getURLParameter(parseInt(t))}},evaluateHTMLDBExpressionWithObject:function(e,t){var r,a=String(e).split("{{"),n=null,i="",o="",l="",d=0;if(a.length<=1)return e;r=a.length;for(var u="",T=1;T<r;T++){for(i=a[T],d=1;"}"!=i[d-1]&&"}"!=i[d];)d++;(n=String(i).substr(0,d).split(".")).length>1?(n[0],o=n[1]):("",o=n[0]),u=void 0!==t[o]?t[o]:"{{"+o+"}}",l=String(i).substr(d+2),i=u+(l=String(l).replace(/(?:\r\n|\r|\n)/g,"")),a[T]=i}return a.length>1&&(returnValue=a.join("")),returnValue},exploreHTMLDBElement:function(e,t){var r=!1,a="";if(t=" "+t+" ",-1!=(a=" "+e.className+" ").indexOf(t))return e;var n=e.parentNode;for(a=" "+n.className+" ";!r&&-1==a.indexOf(t);)a=" "+(n=n.parentNode).className+" ","body"==n.tagName.toLowerCase()&&(r=!0);if(r)throw new Error("HTMLDB "+t+" element not found.");return n},exploreHTMLDBTable:function(e){for(var t=!1,r=HTMLDB.getHTMLDBParameter(e,"table");!t&&""==r;)e=e.parentNode,r=HTMLDB.getHTMLDBParameter(e,"table"),"body"==e.tagName.toLowerCase()&&(t=!0);if(parentElement=HTMLDB.e(r),!parentElement)throw new Error("HTMLDB table "+r+" not found.");return parentElement},exploreHTMLDBForm:function(e){return HTMLDB.exploreHTMLDBElement(e,"htmldb-form")},exploreHTMLDBPagination:function(e){return HTMLDB.exploreHTMLDBElement(e,"htmldb-pagination")},exploreHTMLDBCheckboxGroup:function(e){return HTMLDB.exploreHTMLDBElement(e,"htmldb-checkbox-group")},doReaderIframeLoad:function(e){HTMLDB.doReaderIframeDefaultLoad(e,!1),HTMLDB.render(HTMLDB.getEventTarget(e).parentNode.parentNode)},doRefreshButtonClick:function(){HTMLDB.initializeReadQueue()},doIndexedDBUpgradeNeeded:function(){if(null==HTMLDB.indexedDBConnection)throw new Error("HTMLDB IndexedDB not initialized.");for(var e=HTMLDB.indexedDBConnection.result,t=HTMLDB.indexedDBTables.length,r=0;r<t;r++)e.objectStoreNames.contains("htmldb_"+HTMLDB.indexedDBTables[r]+"_reader")||e.createObjectStore("htmldb_"+HTMLDB.indexedDBTables[r]+"_reader"),e.objectStoreNames.contains("htmldb_"+HTMLDB.indexedDBTables[r]+"_writer")||e.createObjectStore("htmldb_"+HTMLDB.indexedDBTables[r]+"_writer")},checkIfIndexedDBTableExists:function(e){if(null==HTMLDB.indexedDBConnection)throw new Error("HTMLDB IndexedDB not initialized.");var t,r,a=e.getAttribute("id"),n=HTMLDB.indexedDBConnection.result;return t=n.objectStoreNames.contains("htmldb_"+a+"_reader"),r=n.objectStoreNames.contains("htmldb_"+a+"_writer"),t&&r},doAddButtonClick:function(e){var t=HTMLDB.getEventTarget(e),r=HTMLDB.e(HTMLDB.getHTMLDBParameter(t,"form"));if(!r)throw new Error("Add button HTMLDB form not found.");HTMLDB.resetForm(r);var a=HTMLDB.convertFormToObject(r),n=HTMLDB.getHTMLDBParameter(t,"form-defaults");a=HTMLDB.parseObjectDefaults(a,n),HTMLDB.renderFormElement(r,a),r.dispatchEvent(new CustomEvent("htmldbadd",{detail:{}}))},doAddOptionClick:function(e){var t=HTMLDB.getEventTarget(e),r=HTMLDB.e(HTMLDB.getHTMLDBParameter(t,"add-option-form"));if(!r)throw new Error("Add option HTMLDB form not found.");HTMLDB.resetForm(r);var a=HTMLDB.convertFormToObject(r),n=HTMLDB.getHTMLDBParameter(t,"add-option-form-defaults");a=HTMLDB.parseObjectDefaults(a,n),HTMLDB.renderFormElement(r,a),r.dispatchEvent(new CustomEvent("htmldbadd",{detail:{}})),t.dispatchEvent(new CustomEvent("htmldbaddoptionclick",{detail:{}})),void 0!==t.HTMLDBInitials&&(t.HTMLDBInitials.renderValue=void 0),t.HTMLDBInitials.selectNewOption=!0},doSaveButtonClick:function(e){var t=HTMLDB.getEventTarget(e);t||(t=e.target),(t=HTMLDB.exploreHTMLDBElement(t,"htmldb-button-save")).dispatchEvent(new CustomEvent("htmldbbeforesave",{detail:{}}));var r=HTMLDB.getHTMLDBParameter(t,"form"),a=HTMLDB.getHTMLDBParameter(t,"checkbox-group"),n=null,i=null,o=HTMLDB.isHTMLDBParameter(t,"validate-only"),l=HTMLDB.getHTMLDBParameter(t,"validate-url");if(""==r&&""==a)n=HTMLDB.exploreHTMLDBForm(t);else if(""!=r){if(!(n=HTMLDB.e(r)))throw new Error("Save button HTMLDB form not found.")}else if(!(i=HTMLDB.e(a)))throw new Error("Save button HTMLDB checbox group not found.");var d="",u=null;if(null!=n){if(d=HTMLDB.getHTMLDBParameter(n,"table"),!(u=HTMLDB.e(d)))throw new Error(r+" form HTMLDB table not found.")}else if(d=HTMLDB.getHTMLDBParameter(i,"table"),!(u=HTMLDB.e(d)))throw new Error(r+" checkbox group HTMLDB table not found.");var T=[],s={},L="",c="";if(null!=n)c=HTMLDB.getHTMLDBParameter(t,"form-defaults"),s=HTMLDB.convertFormToObject(n,s),s=HTMLDB.parseObjectDefaults(s,c),T.push(s);else{var D=i.querySelectorAll(".htmldb-checkbox:checked"),M=D.length,B=null,H=0;L=HTMLDB.getHTMLDBParameter(i,"checkbox-group-defaults");for(var g=0;g<M;g++)B=D[g],s={},H=parseInt(HTMLDB.getHTMLDBParameter(B,"checkbox-id")),c=HTMLDB.getHTMLDBParameter(B,"checkbox-defaults"),s=isNaN(s)||0==H?{id:0}:HTMLDB.get(u,H),s=HTMLDB.parseObjectDefaults(s,L),s=HTMLDB.parseObjectDefaults(s,c),T.push(s)}HTMLDB.clearErrorsAndMessages(u),""!=l&&HTMLDB.setHTMLDBParameter(u,"overridden-validat-url",l),HTMLDB.validate(u,T,function(e,r){var a=null;try{a=JSON.parse(String(decodeURIComponent(r)).trim())}catch(t){throw new Error("HTMLDB table "+e.getAttribute("id")+" could not be validated: Not valid JSON format")}if(a.errorCount>0)HTMLDB.showError(e,a.lastError);else{HTMLDB.showMessage(e,a.lastMessage);for(var n=T.length,i={},l=0;l<n;l++)i=T[l],o||HTMLDB.insert(e,i);t.dispatchEvent(new CustomEvent("htmldbsave",{detail:{}}))}})},convertFormToObject:function(e,t){clearTimeout(e.HTMLDBFormToObjectTimeoutTimer),e.HTMLDBFormToObjectTimeoutTimer=setTimeout(function(){clearTimeout(e.HTMLDBFormToObjectTimeoutTimer),e.HTMLDBFormToObjectCache=void 0},100);var r={};if(void 0!==t&&(r=t),void 0!==e.HTMLDBFormToObjectCache){if(void 0===t)return e.HTMLDBFormToObjectCache;var a="";for(a in e.HTMLDBFormToObjectCache)e.HTMLDBFormToObjectCache.hasOwnProperty(a)&&(r[a]=e.HTMLDBFormToObjectCache[a])}for(var n=e.querySelectorAll(".htmldb-field"),i=n.length,o=null,l=0;l<i;l++)(o=n[l]).dispatchEvent(new CustomEvent("htmldbgetvalue",{detail:{}}));for(l=0;l<i;l++)o=n[l],HTMLDB.hasHTMLDBParameter(o,"htmldb-field")&&(r[o.getAttribute("data-htmldb-field")]=HTMLDB.getInputValue(o));return e.HTMLDBFormToObjectCache=r,r},showLoader:function(e,t){var r=HTMLDB.getHTMLDBParameter(e,t+"-loader");if(""==r&&(r=HTMLDB.getHTMLDBParameter(e,"loader")),""!=r){var a=HTMLDB.e(r);void 0===a.depth&&(a.depth=0),a.depth+=1;1==a.depth&&-1==(" "+a.className+" ").indexOf(" active ")&&(a.className+=" active")}},hideLoader:function(e,t){var r=HTMLDB.getHTMLDBParameter(e,t+"-loader");if(""==r&&(r=HTMLDB.getHTMLDBParameter(e,"loader")),""!=r){var a=HTMLDB.e(r);void 0===a.depth?a.depth=0:a.depth-=1,a.depth<0?a.depth=0:0==a.depth&&(a.className=String(a.className.replace(/\bactive\b/g,"")).trim())}},hideLoaders:function(){for(var e=HTMLDB.q(".htmldb-table"),t=e.length,r=null,a="",n=0;n<t;n++)r=e[n],""!=(a=HTMLDB.getHTMLDBParameter(r,"read-loader"))&&(HTMLDB.e(a).depth=0,HTMLDB.hideLoader(r,"read")),""!=(a=HTMLDB.getHTMLDBParameter(r,"write-loader"))&&(HTMLDB.e(a).depth=0,HTMLDB.hideLoader(r,"write")),""!=(a=HTMLDB.getHTMLDBParameter(r,"validate-loader"))&&(HTMLDB.e(a).depth=0,HTMLDB.hideLoader(r,"validate")),""!=(a=HTMLDB.getHTMLDBParameter(r,"loader"))&&(HTMLDB.e(a).depth=0,HTMLDB.hideLoader(r,""))},showError:function(e,t){if(null!=t&&""!=t){for(var r=e.getAttribute("id"),a=HTMLDB.q(".htmldb-error"),n=a.length,i=null,o=0;o<n;o++)i=a[o],HTMLDB.getHTMLDBParameter(i,"table")==r&&(i.innerHTML=t,HTMLDB.hasHTMLDBParameter(i,"error-class")&&i.classList.add(HTMLDB.getHTMLDBParameter(i,"error-class")),i.dispatchEvent(new CustomEvent("htmldberror",{detail:{tableElementId:r,errorText:t}})));e.dispatchEvent(new CustomEvent("htmldberror",{detail:{errorText:t}}))}},showMessage:function(e,t){if(null!=t&&""!=t){for(var r=e.getAttribute("id"),a=HTMLDB.q(".htmldb-message"),n=a.length,i=null,o=0;o<n;o++)i=a[o],HTMLDB.getHTMLDBParameter(i,"table")==r&&(i.innerHTML=t,HTMLDB.hasHTMLDBParameter(i,"message-class")&&i.classList.add(HTMLDB.getHTMLDBParameter(i,"message-class")),i.dispatchEvent(new CustomEvent("htmldbmessage",{detail:{tableElementId:r,messageText:t}})));e.dispatchEvent(new CustomEvent("htmldbmessage",{detail:{messageText:t}}))}},clearErrorsAndMessages:function(e){for(var t=e.getAttribute("id"),r=HTMLDB.q(".htmldb-error,.htmldb-message"),a=r.length,n=null,i=0;i<a;i++)n=r[i],HTMLDB.getHTMLDBParameter(n,"table")==t&&(HTMLDB.hasHTMLDBParameter(n,"message-class")&&n.classList.remove(HTMLDB.getHTMLDBParameter(n,"message-class")),HTMLDB.hasHTMLDBParameter(n,"error-class")&&n.classList.remove(HTMLDB.getHTMLDBParameter(n,"error-class")),n.innerHTML="")},doEditButtonClick:function(e){var t=null,r=null,a=HTMLDB.getEventTarget(e),n=HTMLDB.getHTMLDBParameter(a,"table"),i=HTMLDB.getHTMLDBParameter(a,"form");if(""!=i){if(!(r=HTMLDB.e(i)))throw new Error("Edit button HTMLDB form "+i+" not found.");""==n&&(n=HTMLDB.getHTMLDBParameter(r,"table"))}if(""!=n&&(t=HTMLDB.e(n)),null==t)throw new Error("Edit button HTMLDB table "+n+" not found.");if(""==HTMLDB.getHTMLDBParameter(a,"edit-id"))throw new Error("Edit button data-htmldb-edit-id attribute not specified.");HTMLDB.setActiveId(t,HTMLDB.getHTMLDBParameter(a,"edit-id")),r&&r.dispatchEvent(new CustomEvent("htmldbedit",{detail:{}}))},doSelectChange:function(e){var t=HTMLDB.getEventTarget(e),r=HTMLDB.getHTMLDBParameter(t,"add-option-caption");""!=r&&r==HTMLDB.getInputValue(t)&&(HTMLDB.doAddOptionClick(e),resetValue=HTMLDB.evaluateHTMLDBExpression(HTMLDB.getHTMLDBParameter(t,"reset-value")),HTMLDB.setInputValue(t,resetValue),t.dispatchEvent(new CustomEvent("htmldbreset",{detail:{value:resetValue}})))},doWriterIframeLoad:function(e){var t=HTMLDB.getEventTarget(e);tableElement=HTMLDB.getEventTarget(e).parentNode.parentNode,tableElement.setAttribute("data-htmldb-loading",0),HTMLDB.hideLoader(tableElement,"write"),iframeWindow=top.frames[t.getAttribute("id")];var r="";iframeWindow.document&&(r=String(iframeWindow.document.body.innerHTML).trim());var a=tableElement.getAttribute("id")+"_iframe_",n=t.getAttribute("id").substr(a.length);HTMLDB.removeIframeAndForm(tableElement,n);var i=null;try{i=JSON.parse(String(decodeURIComponent(r)).trim())}catch(e){throw new Error("HTMLDB table "+tableElement.getAttribute("id")+" could not be written: Not valid JSON format")}void 0!==i.errorCount&&i.errorCount>0?HTMLDB.showError(tableElement,i.lastError):void 0!==i.messageCount&&i.messageCount>0&&HTMLDB.showMessage(tableElement,i.lastMessage),(void 0===i.errorCount||void 0!==i.errorCount&&0==i.errorCount)&&HTMLDB.updateReadQueueWithParameter(tableElement,"refresh-table")},doValidatorIframeLoad:function(e){var t=HTMLDB.getEventTarget(e);tableElement=t.parentNode.parentNode,tableElement.setAttribute("data-htmldb-loading",0),HTMLDB.hideLoader(tableElement,"validate"),iframeWindow=top.frames[t.getAttribute("id")];var r="";iframeWindow.document&&(r=String(iframeWindow.document.body.innerHTML).trim());var a=tableElement.getAttribute("id")+"_iframe_",n=iframeHTMLDB.getAttribute("id").substr(a.length);HTMLDB.removeIframeAndForm(tableElement,n),tableElement.doHTMLDBValidate&&tableElement.doHTMLDBValidate(e,r)},getInputValue:function(e){var t,r,a=null,n=0,i="";switch(t=String(e.tagName).toLowerCase(),r=String(e.getAttribute("type")).toLowerCase(),t){case"input":if("checkbox"==r)return e.checked?1:0;if("radio"==r){for(var o=document.getElementsByName(e.name),l="",d=0;d<o.length;d++)o[d].checked&&(l=o[d].value);return l}return"date"==r?new Date(e.value).getTime():e.value;case"button":case"textarea":return e.value;case"select":if(-1==e.selectedIndex)return"";i="",n=(a=e.querySelectorAll("option:checked")).length;for(d=0;d<n;d++)""!=i&&(i+=","),i+=a[d].value;return i}return""},setInputValue:function(e,t,r){var a=String(e.tagName).toLowerCase(),n=String(e.getAttribute("type")).toLowerCase(),i=0,o="";switch(t=String(t).replace(/&amp;/g,"&"),a){case"input":"checkbox"==n?e.checked="1"==t:"radio"==n?e.value==t&&(e.checked=!0):"date"==n?(o=(i=new Date(parseInt(t))).getFullYear()+"-"+("0"+(i.getMonth()+1)).slice(-2)+"-"+("0"+i.getDate()).slice(-2),e.defaultValue=o,e.value=o):e.value=t;break;case"textarea":t=t.replace(/\\n/g,"\n",t).replace(/\\r/g,"",t),e.innerHTML=t,e.value=t;break;case"select":void 0===e.HTMLDBInitials&&(e.HTMLDBInitials={}),e.HTMLDBInitials.previousValue=e.value,e.value=t}!0!==r&&HTMLDB.doActiveElementToggle(e)},removeReadQueueCallbacks:function(){HTMLDB.readQueueCallbacks=[]},callReadQueueCallbacks:function(e){if(0==HTMLDB.readQueue.length&&0==HTMLDB.readingQueue.length&&HTMLDB.isIdle()){var t=document.body.HTMLDBCompleteTimer;clearTimeout(t),t=setTimeout(function(){document.body.dispatchEvent(new CustomEvent("htmldbreadqueuecomplete",{detail:{}}))},300),document.body.HTMLDBCompleteTimer=t}if(void 0!==HTMLDB.readQueueCallbacks[e.getAttribute("id")])for(;HTMLDB.readQueueCallbacks[e.getAttribute("id")].length>0;)HTMLDB.readQueueCallbacks[e.getAttribute("id")].shift()()},getEventTarget:function(e){var t=e.currentTarget;return t||(t=e.target),t},escapeSingleQuote:function(e){return String(e).replace(/'/g,"&#039;")},doReaderIframeDefaultLoad:function(e){var t=HTMLDB.getEventTarget(e),r=t.parentNode.parentNode,a=t.parentNode.parentNode.getAttribute("id"),n=HTMLDB.getActiveId(r),i=!1,o=HTMLDB.e(a+"_reader_tbody"),l=HTMLDB.e(a+"_reader_thead"),d=HTMLDB.getEventTarget(e);iframeWindow=top.frames[t.getAttribute("id")];var u="";if(iframeWindow.document&&(u=String(iframeWindow.document.body.innerHTML).trim()),""!=u){var T=[];try{T=JSON.parse(String(decodeURIComponent(u)).trim())}catch(e){throw new Error("HTMLDB table "+r.getAttribute("id")+" could not be read: Not valid JSON format from URL "+d.src)}if(void 0!==T.errorCount&&T.errorCount>0)HTMLDB.showError(r,T.lastError);else if(void 0!==T.messageCount&&T.messageCount>0)HTMLDB.showMessage(r,T.lastMessage);else if(void 0!==T.r){HTMLDB.isHTMLDBParameter(r,"local")&&HTMLDB.clearLocalTable(r);var s=T.c,L=T.r.length,c=T.c.length,D="",M="",B=null,H={};for(M="<tr>",j=0;j<c;j++)M+="<th>"+s[j]+"</th>";M+="</tr>";var g="",m=!1;HTMLDB.updateTableFilterFunction(r);for(var b=0;b<L;b++)H=HTMLDB.convertListRowToObject(T.r[b],T.c),r.filterFunction&&!r.filterFunction(H)||((B=HTMLDB.e(a+"_reader_tr"+T.r[b][0]))&&B.parentNode.removeChild(B),m||(g=T.r[b][0],m=!0),n==T.r[b][0]&&(i=!0),D+='<tr class="refreshed" data-row-id="'+T.r[b][0]+'" id="'+a+"_reader_tr"+T.r[b][0]+'">',D+=HTMLDB.generateTDHTML(r,"_reader",H,T.r[b][0]),D+="</tr>",HTMLDB.isHTMLDBParameter(r,"local")&&HTMLDB.updateLocal(r,T.r[b][0],H,!0));l.innerHTML=M,o.innerHTML+=D,HTMLDB.e(r.getAttribute("id")+"_writer_thead").innerHTML=M,i?r.setAttribute("data-htmldb-active-id",n):r.setAttribute("data-htmldb-active-id",g)}}var f=r.getAttribute("id")+"_iframe_",v=t.getAttribute("id").substr(f.length);HTMLDB.removeIframeAndForm(r,v),r.setAttribute("data-htmldb-loading",0),HTMLDB.hideLoader(r,"read"),setTimeout(function(){HTMLDB.removeFromReadingQueue(r),HTMLDB.callReadQueueCallbacks(r),HTMLDB.updateReadQueueByParentTable(r),HTMLDB.processReadQueue(),r.dispatchEvent(new CustomEvent("htmldbread",{detail:{remote:!0,local:!1}})),r.dispatchEvent(new CustomEvent("htmldbreadremote",{detail:{remote:!0,local:!1}}))},150)},clearReaderTable:function(e){HTMLDB.e(e.getAttribute("id")+"_reader_tbody").innerHTML=""},clearWriterTable:function(e){HTMLDB.e(e.getAttribute("id")+"_writer_tbody").innerHTML=""},clearLocalTable:function(e,t,r){if(null==HTMLDB.indexedDBConnection)throw new Error("HTMLDB IndexedDB not initialized.");if(void 0===t&&(t=!1),void 0===r&&(r=!1),t||HTMLDB.clearReaderTable(e),r||HTMLDB.clearWriterTable(e),HTMLDB.checkIfIndexedDBTableExists(e)){var a=e.getAttribute("id"),n=HTMLDB.indexedDBConnection.result;if(!t)n.transaction("htmldb_"+a+"_reader","readwrite").objectStore("htmldb_"+a+"_reader").clear();if(!r)n.transaction("htmldb_"+a+"_writer","readwrite").objectStore("htmldb_"+a+"_writer").clear()}},isNewObject:function(e){return void 0===e.id||(""==e.id||(0==parseInt(e.id)||"n"==e.id[0]))},addLeadingZeros:function(e,t){for(var r=String(e);r.length<(t||2);)r="0"+r;return r},e:function(e){return""==e?void 0:document.getElementById(e)},q:function(e){return document.body.querySelectorAll(e)},pause:function(){HTMLDB.pausing=!0},resume:function(){HTMLDB.pausing=!1},isPaused:function(){return HTMLDB.pausing},addParentLoadingClass:function(e){if(HTMLDB.hasHTMLDBParameter(e,"parent-loading-class")){for(var t=HTMLDB.getHTMLDBParameter(e,"parent-loading-class"),r=e;t>0;)r=r.parentNode,t--;r&&r.classList.add("htmldb-loading")}},removeParentLoadingClass:function(e){if(HTMLDB.hasHTMLDBParameter(e,"parent-loading-class")){for(var t=HTMLDB.getHTMLDBParameter(e,"parent-loading-class"),r=e;t>0;)r=r.parentNode,t--;r&&r.classList.remove("htmldb-loading")}}};HTMLDB.initialize(),function(){if("function"==typeof window.CustomEvent)return!1;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var r=document.createEvent("CustomEvent");return r.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),r}e.prototype=window.Event.prototype,window.CustomEvent=e}();